import sqlite3
import json

DB_NAME = "SemanticGrove.db"

def add_iq_batch2():
    """IQ問題追加（第2弾・50問）"""
    conn = sqlite3.connect(DB_NAME)
    cursor = conn.cursor()
    
    print("=" * 60)
    print("IQ問題追加スクリプト（第2弾）")
    print("=" * 60)
    
    questions = []
    
    # ==================== 数列問題（15問・やや難） ====================
    print("[1/4] 数列問題を生成中...")
    
    number_series = [
        ("次の数列で?に入る数字はどれですか？\n2, 6, 12, 20, 30, ?",
         [{"id":"A","text":"40"},{"id":"B","text":"42"},{"id":"C","text":"44"},{"id":"D","text":"48"}],
         [1], "数列", "4", 15, "n(n+1)の数列：1×2, 2×3, 3×4, 4×5, 5×6, 6×7", "積の数列"),
        
        ("次の数列で?に入る数字はどれですか？\n1, 4, 10, 22, 46, ?",
         [{"id":"A","text":"92"},{"id":"B","text":"94"},{"id":"C","text":"96"},{"id":"D","text":"98"}],
         [1], "数列", "5", 20, "2倍+2を繰り返す", "複合演算パターン"),
        
        ("次の数列で?に入る数字はどれですか？\n3, 4, 7, 11, 18, ?",
         [{"id":"A","text":"27"},{"id":"B","text":"29"},{"id":"C","text":"31"},{"id":"D","text":"33"}],
         [1], "数列", "4", 15, "フィボナッチ型：前2つの和", "加算数列"),
        
        ("次の数列で?に入る数字はどれですか？\n5, 11, 23, 47, 95, ?",
         [{"id":"A","text":"189"},{"id":"B","text":"191"},{"id":"C","text":"193"},{"id":"D","text":"195"}],
         [1], "数列", "5", 20, "2倍+1を繰り返す", "等比的パターン"),
        
        ("次の数列で?に入る数字はどれですか？\n144, 121, 100, 81, 64, ?",
         [{"id":"A","text":"49"},{"id":"B","text":"48"},{"id":"C","text":"36"},{"id":"D","text":"25"}],
         [0], "数列", "3", 10, "平方数の降順：12², 11², 10², 9², 8², 7²", "逆順平方数"),
        
        ("次の数列で?に入る数字はどれですか？\n2, 5, 11, 23, 47, ?",
         [{"id":"A","text":"93"},{"id":"B","text":"95"},{"id":"C","text":"97"},{"id":"D","text":"99"}],
         [1], "数列", "5", 20, "2倍+1を繰り返す", "指数的増加"),
        
        ("次の数列で?に入る数字はどれですか？\n1, 2, 6, 24, 120, ?",
         [{"id":"A","text":"600"},{"id":"B","text":"620"},{"id":"C","text":"720"},{"id":"D","text":"840"}],
         [2], "数列", "5", 20, "階乗：1!, 2!, 3!, 4!, 5!, 6!", "階乗数列"),
        
        ("次の数列で?に入る数字はどれですか？\n0, 3, 8, 15, 24, ?",
         [{"id":"A","text":"33"},{"id":"B","text":"35"},{"id":"C","text":"37"},{"id":"D","text":"39"}],
         [1], "数列", "4", 15, "n²-1の数列", "二次関数パターン"),
        
        ("次の数列で?に入る数字はどれですか？\n7, 14, 28, 56, 112, ?",
         [{"id":"A","text":"168"},{"id":"B","text":"196"},{"id":"C","text":"224"},{"id":"D","text":"240"}],
         [2], "数列", "3", 10, "2倍ずつ増加", "等比数列"),
        
        ("次の数列で?に入る数字はどれですか？\n1, 5, 14, 30, 55, ?",
         [{"id":"A","text":"85"},{"id":"B","text":"90"},{"id":"C","text":"91"},{"id":"D","text":"95"}],
         [2], "数列", "5", 20, "差が4,9,16,25,36（平方数）", "二重階差数列"),
        
        ("次の数列で?に入る数字はどれですか？\n81, 27, 9, 3, ?",
         [{"id":"A","text":"0"},{"id":"B","text":"1"},{"id":"C","text":"2"},{"id":"D","text":"3"}],
         [1], "数列", "3", 10, "3で割り続ける：81÷3=27÷3=9÷3=3÷3=1", "等比数列（減少）"),
        
        ("次の数列で?に入る数字はどれですか？\n2, 8, 18, 32, 50, ?",
         [{"id":"A","text":"68"},{"id":"B","text":"70"},{"id":"C","text":"72"},{"id":"D","text":"74"}],
         [2], "数列", "4", 15, "2n²の数列", "二次関数"),
        
        ("次の数列で?に入る数字はどれですか？\n1, 3, 4, 7, 11, 18, ?",
         [{"id":"A","text":"27"},{"id":"B","text":"28"},{"id":"C","text":"29"},{"id":"D","text":"30"}],
         [2], "数列", "4", 15, "フィボナッチ型：前2つの和", "トリボナッチ変形"),
        
        ("次の数列で?に入る数字はどれですか？\n6, 12, 24, 48, 96, ?",
         [{"id":"A","text":"144"},{"id":"B","text":"168"},{"id":"C","text":"192"},{"id":"D","text":"216"}],
         [2], "数列", "3", 10, "2倍ずつ増加", "等比数列"),
        
        ("次の数列で?に入る数字はどれですか？\n1, 8, 27, 64, 125, 216, ?",
         [{"id":"A","text":"243"},{"id":"B","text":"294"},{"id":"C","text":"343"},{"id":"D","text":"512"}],
         [2], "数列", "4", 15, "立方数：1³, 2³, 3³, 4³, 5³, 6³, 7³", "立方数列"),
    ]
    
    for q in number_series:
        questions.append(create_question("IQ", *q))
    
    print(f"  ✓ 数列問題: {len(number_series)}問")
    
    # ==================== 論理パズル（15問・やや難） ====================
    print("[2/4] 論理パズル問題を生成中...")
    
    logic_puzzles = [
        ("3人の囚人A,B,Cがいる。看守が「少なくとも1人は処刑される」と言った。Aは「Bが処刑される」と知らされた。Aの処刑確率は？",
         [{"id":"A","text":"1/2"},{"id":"B","text":"1/3"},{"id":"C","text":"2/3"},{"id":"D","text":"判断できない"}],
         [0], "論理", "6", 25, "条件付き確率：新情報で確率が変化", "モンティ・ホール類似問題"),
        
        ("5人が競争した。太郎は花子より速い。次郎は太郎より速い。三郎は全員より遅い。四郎は次郎より遅い。2位は誰？",
         [{"id":"A","text":"四郎"},{"id":"B","text":"太郎"},{"id":"C","text":"判断できない"},{"id":"D","text":"花子"}],
         [2], "論理", "5", 20, "次郎が1位は確定だが、四郎と太郎の順序不明", "不完全情報"),
        
        ("AかBかCのうち1人だけ真実を言う。A「Bは嘘つき」B「Cは嘘つき」C「Aは正直者」。真実を言っているのは？",
         [{"id":"A","text":"B"},{"id":"B","text":"A"},{"id":"C","text":"C"},{"id":"D","text":"判断できない"}],
         [0], "論理", "6", 25, "Bが真実なら、Cは嘘つき→Aは嘘つき→Bは正直（矛盾なし）", "真偽判定パズル"),
        
        ("100人の村で、全員が帽子を被っている。赤50人、青50人。自分の色は見えない。全員が同時に予想。何人正解する？",
         [{"id":"A","text":"50人"},{"id":"B","text":"100人"},{"id":"C","text":"0人"},{"id":"D","text":"判断できない"}],
         [0], "論理", "5", 20, "情報なしで予想すると、期待値は50人", "確率論"),
        
        ("3つのドアの1つに賞品。選んだ後、ホストが外れを1つ開ける。変更すべきか？",
         [{"id":"A","text":"変更すべき"},{"id":"B","text":"変更すべきでない"},{"id":"C","text":"どちらでも同じ"},{"id":"D","text":"判断できない"}],
         [0], "論理", "6", 25, "モンティ・ホール問題：変更で2/3の確率", "有名な確率パラドックス"),
        
        ("2人が数字を額に貼られる。2人の和か差が25と知らされる。A「20」B「?」。Bは自分の数字がわかる？",
         [{"id":"A","text":"わかる"},{"id":"B","text":"わからない"},{"id":"C","text":"場合による"},{"id":"D","text":"情報不足"}],
         [0], "論理", "5", 20, "20+?=25または20-?=25より、?=5または-5だがマイナスはないので5", "論理的推論"),
        
        ("赤い帽子3個、青い帽子2個。3人に見えないよう被せる。各人は他の2人の帽子を見て自分の色を推理。全員が推理できない場合、何色？",
         [{"id":"A","text":"赤"},{"id":"B","text":"青"},{"id":"C","text":"判断できない"},{"id":"D","text":"両方ありえる"}],
         [0], "論理", "6", 25, "全員推理できない→3人とも赤（青2人見たら残りは赤と確定するため）", "帽子パズル"),
        
        ("100階建てのビルから卵を落とす。何階から割れるか調べる。卵2個。最小の試行回数で調べる最適戦略は？",
         [{"id":"A","text":"14回"},{"id":"B","text":"10回"},{"id":"C","text":"20回"},{"id":"D","text":"50回"}],
         [0], "論理", "6", 25, "n(n+1)/2≧100を満たす最小n=14", "最適化問題"),
        
        ("島に赤目と青目の人がいる。赤目は青目の数を知っている。ある日、外来者が「少なくとも1人は赤目」と言った。何が起こる？",
         [{"id":"A","text":"赤目全員が同時に島を出る"},{"id":"B","text":"何も起こらない"},{"id":"C","text":"青目が出る"},{"id":"D","text":"判断できない"}],
         [0], "論理", "6", 25, "共有知識の成立により論理的推論が可能に", "帰納的論理パズル"),
        
        ("10人が円形に座る。隣同士は握手しない。最大何組が握手できる？",
         [{"id":"A","text":"35組"},{"id":"B","text":"30組"},{"id":"C","text":"25組"},{"id":"D","text":"20組"}],
         [1], "論理", "5", 20, "10C2-10=45-10=35だが制約ありで30", "組み合わせ論"),
        
        ("A,B,C,Dが一列に並ぶ。AとBは隣り合わない。何通り？",
         [{"id":"A","text":"12通り"},{"id":"B","text":"14通り"},{"id":"C","text":"16通り"},{"id":"D","text":"18通り"}],
         [0], "論理", "5", 20, "全24通り-隣接12通り=12通り", "場合の数"),
        
        ("正直者と嘘つきの村。ある人に「あなたは正直者？」と聞くと「はい」。何者？",
         [{"id":"A","text":"判断できない"},{"id":"B","text":"正直者"},{"id":"C","text":"嘘つき"},{"id":"D","text":"どちらでもない"}],
         [0], "論理", "4", 15, "正直者も嘘つきも「はい」と答える", "論理パラドックス"),
        
        ("3人で100個の石を取り合うゲーム。順番に1-3個取る。最後を取った人が負け。先手必勝？",
         [{"id":"A","text":"先手必勝"},{"id":"B","text":"後手必勝"},{"id":"C","text":"3番手必勝"},{"id":"D","text":"引き分け"}],
         [0], "論理", "6", 25, "4の倍数を残す戦略", "ゲーム理論"),
        
        ("5個のコインがある。1個だけ偽物（軽い）。天秤2回で見つけられる？",
         [{"id":"A","text":"見つけられる"},{"id":"B","text":"見つけられない"},{"id":"C","text":"運次第"},{"id":"D","text":"3回必要"}],
         [0], "論理", "5", 20, "2-2-1の分割で可能", "情報理論"),
        
        ("8人が円卓に座る。男女交互に座る。男4人女4人。何通り？",
         [{"id":"A","text":"144通り"},{"id":"B","text":"288通り"},{"id":"C","text":"576通り"},{"id":"D","text":"1152通り"}],
         [0], "論理", "5", 20, "円順列：(4-1)!×4!=6×24=144", "円順列の計算"),
    ]
    
    for q in logic_puzzles:
        questions.append(create_question("IQ", *q))
    
    print(f"  ✓ 論理パズル: {len(logic_puzzles)}問")
    
    # ==================== 言語推理（10問・中〜難） ====================
    print("[3/4] 言語推理問題を生成中...")
    
    verbal_reasoning = [
        ("「成功：失敗」の関係と最も近いものはどれですか？",
         [{"id":"A","text":"勝利：敗北"},{"id":"B","text":"高い：低い"},{"id":"C","text":"明るい：暗い"},{"id":"D","text":"早い：遅い"}],
         [0], "言語", "3", 10, "反対の結果を示す対義語", "結果の対立"),
        
        ("「鳥：羽」「魚：？」。?に入るものは？",
         [{"id":"A","text":"鱗"},{"id":"B","text":"ヒレ"},{"id":"C","text":"エラ"},{"id":"D","text":"尾"}],
         [0], "言語", "3", 10, "体表を覆うもの", "類推・対応"),
        
        ("次の単語の関係：「高い：低い」「速い：？」",
         [{"id":"A","text":"遅い"},{"id":"B","text":"小さい"},{"id":"C","text":"弱い"},{"id":"D","text":"軽い"}],
         [0], "言語", "2", 10, "速度の対義語", "対義語の理解"),
        
        ("「医師：診察」「教師：？」",
         [{"id":"A","text":"授業"},{"id":"B","text":"学校"},{"id":"C","text":"生徒"},{"id":"D","text":"本"}],
         [0], "言語", "3", 10, "職業と主要業務", "職業と行為"),
        
        ("「東京：日本」「パリ：？」",
         [{"id":"A","text":"フランス"},{"id":"B","text":"ヨーロッパ"},{"id":"C","text":"都市"},{"id":"D","text":"首都"}],
         [0], "言語", "2", 10, "首都と国の関係", "地理的対応"),
        
        ("次のうち他と性質が異なるものは？\n正方形、長方形、円、三角形",
         [{"id":"A","text":"円"},{"id":"B","text":"正方形"},{"id":"C","text":"長方形"},{"id":"D","text":"三角形"}],
         [0], "言語", "3", 10, "円だけ曲線、他は直線図形", "分類・仲間外れ"),
        
        ("「始まり：終わり」「誕生：？」",
         [{"id":"A","text":"死"},{"id":"B","text":"成長"},{"id":"C","text":"老い"},{"id":"D","text":"生"}],
         [0], "言語", "3", 10, "対となる終点", "ライフサイクルの対応"),
        
        ("「種：植物」「卵：？」",
         [{"id":"A","text":"鳥"},{"id":"B","text":"動物"},{"id":"C","text":"ヒナ"},{"id":"D","text":"巣"}],
         [0], "言語", "4", 15, "子孫を生み出すもの", "生物学的対応"),
        
        ("「熱い：冷たい」「濡れている：？」",
         [{"id":"A","text":"乾いている"},{"id":"B","text":"暖かい"},{"id":"C","text":"冷たい"},{"id":"D","text":"固い"}],
         [0], "言語", "2", 10, "水分状態の対義語", "状態の対立"),
        
        ("「分子：原子」「文：？」",
         [{"id":"A","text":"単語"},{"id":"B","text":"文章"},{"id":"C","text":"段落"},{"id":"D","text":"本"}],
         [0], "言語", "4", 15, "より小さい構成要素", "階層構造の理解"),
    ]
    
    for q in verbal_reasoning:
        questions.append(create_question("IQ", *q))
    
    print(f"  ✓ 言語推理: {len(verbal_reasoning)}問")
    
    # ==================== 図形・パターン（10問・中〜難） ====================
    print("[4/4] 図形・パターン問題を生成中...")
    
    pattern_recognition = [
        ("パターン：1個、3個、5個、7個...次は？",
         [{"id":"A","text":"9個"},{"id":"B","text":"10個"},{"id":"C","text":"11個"},{"id":"D","text":"12個"}],
         [0], "図形", "2", 10, "奇数列：2ずつ増加", "等差数列"),
        
        ("○●○●●○●●●...のパターン。10番目は？",
         [{"id":"A","text":"●"},{"id":"B","text":"○"},{"id":"C","text":"判断できない"},{"id":"D","text":"両方"}],
         [0], "図形", "4", 15, "○の後に●がn個：1,2,3...、10番目は4グループ目の●", "群数列パターン"),
        
        ("正六角形を1個、2個、3個...と並べる。5番目の辺の総数は？",
         [{"id":"A","text":"16本"},{"id":"B","text":"18本"},{"id":"C","text":"20本"},{"id":"D","text":"22本"}],
         [0], "図形", "5", 20, "隣接で共有：6+5×4=26だが重複除外で16", "図形の数え上げ"),
        
        ("△が1つ、次に△4つ（逆さま含む）、次は？",
         [{"id":"A","text":"9個"},{"id":"B","text":"10個"},{"id":"C","text":"13個"},{"id":"D","text":"16個"}],
         [0], "図形", "4", 15, "1,4,9...平方数", "図形での平方数"),
        
        ("時計の長針が1時間で回る角度は？",
         [{"id":"A","text":"360度"},{"id":"B","text":"180度"},{"id":"C","text":"90度"},{"id":"D","text":"30度"}],
         [0], "図形", "2", 10, "1周=360度", "角度の理解"),
        
        ("立方体の展開図。向かい合う面の数の和が7。1の向かいは？",
         [{"id":"A","text":"6"},{"id":"B","text":"5"},{"id":"C","text":"4"},{"id":"D","text":"3"}],
         [0], "図形", "3", 10, "1+6=7", "サイコロの性質"),
        
        ("円を5等分する線を引く。何本必要？",
         [{"id":"A","text":"5本"},{"id":"B","text":"4本"},{"id":"C","text":"10本"},{"id":"D","text":"6本"}],
         [0], "図形", "3", 10, "中心を通る5本の半径", "円の分割"),
        
        ("正方形を対角線で切ると何個の三角形？",
         [{"id":"A","text":"2個"},{"id":"B","text":"4個"},{"id":"C","text":"8個"},{"id":"D","text":"16個"}],
         [0], "図形", "2", 10, "1本の対角線で2個", "基本的分割"),
        
        ("○○●●○○●●...のパターン。16番目は？",
         [{"id":"A","text":"●"},{"id":"B","text":"○"},{"id":"C","text":"判断できない"},{"id":"D","text":"両方"}],
         [0], "図形", "3", 10, "4個周期：16÷4=4で最後が●", "周期性"),
        
        ("1辺が1cmの正方形を1個、4個、9個...と並べる。5番目の周囲の長さは？",
         [{"id":"A","text":"20cm"},{"id":"B","text":"16cm"},{"id":"C","text":"24cm"},{"id":"D","text":"25cm"}],
         [0], "図形", "4", 15, "5×5の正方形の周囲=5×4=20", "周囲の計算"),
    ]
    
    for q in pattern_recognition:
        questions.append(create_question("IQ", *q))
    
    print(f"  ✓ 図形・パターン: {len(pattern_recognition)}問")
    
    # データベースに保存
    print("\nデータベースに保存中...")
    
    for q in questions:
        cursor.execute("""
            INSERT INTO questions (language, question_json, category, difficulty, score, meaning, usage)
            VALUES (?, ?, ?, ?, ?, ?, ?)
        """, q)
    
    conn.commit()
    
    # IQ問題の集計
    cursor.execute("SELECT COUNT(*) FROM questions WHERE language = 'IQ'")
    iq_count = cursor.fetchone()[0]
    
    # 全体集計
    cursor.execute("SELECT COUNT(*) FROM questions")
    total_count = cursor.fetchone()[0]
    
    print("\n" + "=" * 60)
    print("✓ IQ問題追加完了（第2弾）！")
    print("=" * 60)
    print(f"\nIQ問題数: {iq_count}問")
    print(f"全体問題数: {total_count}問")
    print("=" * 60)
    
    conn.close()


def create_question(language, question, options, answer, category, difficulty, score, meaning, usage):
    """問題データを作成"""
    return (
        language,
        json.dumps({
            'question': question,
            'options': options,
            'answer': answer
        }, ensure_ascii=False),
        category,
        difficulty,
        score,
        meaning,
        usage
    )


if __name__ == "__main__":
    add_iq_batch2()