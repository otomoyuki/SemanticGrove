import sqlite3
import json

DB_NAME = "SemanticGrove.db"

def add_iq_batch6():
    """IQ問題追加（第6弾・50問）"""
    conn = sqlite3.connect(DB_NAME)
    cursor = conn.cursor()
    
    print("=" * 60)
    print("IQ問題追加スクリプト（第6弾）")
    print("=" * 60)
    
    questions = []
    
    # ==================== 暗号解読（15問） ====================
    print("[1/4] 暗号解読問題を生成中...")
    
    cipher_questions = [
        ("A=1, B=2, C=3...の法則で「CAT」は？",
         [{"id":"A","text":"24"},{"id":"B","text":"27"},{"id":"C","text":"30"},{"id":"D","text":"33"}],
         [0], "暗号", "3", 10, "C(3)+A(1)+T(20)=24", "文字の数値化"),
        
        ("シーザー暗号で「ABC」を3文字ずらすと？",
         [{"id":"A","text":"DEF"},{"id":"B","text":"XYZ"},{"id":"C","text":"BCD"},{"id":"D","text":"CDE"}],
         [0], "暗号", "3", 10, "各文字を3つ後ろにずらす", "シーザー暗号"),
        
        ("1=A, 2=B...で「8-5-12-12-15」は？",
         [{"id":"A","text":"HELLO"},{"id":"B","text":"WORLD"},{"id":"C","text":"HAPPY"},{"id":"D","text":"BRAVE"}],
         [0], "暗号", "3", 12, "8=H, 5=E, 12=L, 12=L, 15=O", "数字→文字変換"),
        
        ("逆読みで「EMIT」は何を意味する？",
         [{"id":"A","text":"TIME"},{"id":"B","text":"MITE"},{"id":"C","text":"ITEM"},{"id":"D","text":"TEAM"}],
         [0], "暗号", "2", 8, "EMITを逆から読むとTIME", "逆読み暗号"),
        
        ("母音抜き暗号「SMRT」の元の単語は？",
         [{"id":"A","text":"SMART"},{"id":"B","text":"SMORT"},{"id":"C","text":"SUMMER"},{"id":"D","text":"SMARTS"}],
         [0], "暗号", "2", 8, "母音A,I,U,E,Oを省略", "母音省略"),
        
        ("A→Z, B→Y...の法則で「CAT」は？",
         [{"id":"A","text":"XZG"},{"id":"B","text":"XYG"},{"id":"C","text":"WZG"},{"id":"D","text":"XZH"}],
         [0], "暗号", "3", 12, "C→X, A→Z, T→G（反転暗号）", "アトバッシュ暗号"),
        
        ("2倍暗号で「DOG」の数値合計は？(A=2,B=4...)",
         [{"id":"A","text":"46"},{"id":"B","text":"38"},{"id":"C","text":"52"},{"id":"D","text":"44"}],
         [2], "暗号", "3", 12, "D(8)+O(30)+G(14)=52", "倍数暗号"),
        
        ("「12-15-22-5」は何の単語？",
         [{"id":"A","text":"LOVE"},{"id":"B","text":"LIVE"},{"id":"C","text":"LIKE"},{"id":"D","text":"LINE"}],
         [0], "暗号", "2", 10, "L(12)O(15)V(22)E(5)", "位置暗号"),
        
        ("ピッグ・ラテンで「pig」は？",
         [{"id":"A","text":"igpay"},{"id":"B","text":"pigay"},{"id":"C","text":"gpay"},{"id":"D","text":"ipgay"}],
         [0], "暗号", "4", 15, "先頭の子音を後ろに移動+ay", "ピッグ・ラテン"),
        
        ("ROT13で「HELLO」は？",
         [{"id":"A","text":"URYYB"},{"id":"B","text":"SVOOL"},{"id":"C","text":"YVOOL"},{"id":"D","text":"HELLO"}],
         [0], "暗号", "4", 15, "13文字ずつずらす", "ROT13"),
        
        ("二進数「1010」は十進数で？",
         [{"id":"A","text":"10"},{"id":"B","text":"12"},{"id":"C","text":"8"},{"id":"D","text":"14"}],
         [0], "暗号", "3", 10, "8+0+2+0=10", "二進数変換"),
        
        ("モールス信号「•−•」は？",
         [{"id":"A","text":"R"},{"id":"B","text":"K"},{"id":"C","text":"L"},{"id":"D","text":"F"}],
         [0], "暗号", "3", 12, "•−•はRを表す", "モールス信号"),
        
        ("単語暗号：SUN=318, MON=？",
         [{"id":"A","text":"345"},{"id":"B","text":"234"},{"id":"C","text":"456"},{"id":"D","text":"567"}],
         [0], "暗号", "3", 12, "M(13)O(15)N(14)=順番", "位置数列"),
        
        ("カエサル暗号（-2）で「CAT」は？",
         [{"id":"A","text":"AYR"},{"id":"B","text":"BZS"},{"id":"C","text":"DCV"},{"id":"D","text":"EBW"}],
         [0], "暗号", "3", 12, "2文字前に戻す", "逆カエサル"),
        
        ("数字語：「520」は中国語で何を意味する？",
         [{"id":"A","text":"I love you"},{"id":"B","text":"Good night"},{"id":"C","text":"Thank you"},{"id":"D","text":"See you"}],
         [0], "暗号", "4", 15, "5=wu(我), 2=er(爱), 0=ling(你)", "数字語呂合わせ"),
    ]
    
    questions.extend(cipher_questions)
    print(f"  ✓ 暗号解読: {len(cipher_questions)}問")
    
    # ==================== 推理ゲーム（15問） ====================
    print("[2/4] 推理ゲーム問題を生成中...")
    
    reasoning_games = [
        ("3人がそれぞれ嘘つきか正直者。A「私は嘘つき」B「Aは正直者」C「Bは嘘つき」。誰が嘘つき？",
         [{"id":"A","text":"AとB"},{"id":"B","text":"BとC"},{"id":"C","text":"全員"},{"id":"D","text":"A,B,C全員嘘つきはありえない"}],
         [3], "推理", "4", 18, "Aの発言は矛盾（自己言及のパラドックス）", "論理パズル"),
        
        ("赤・青・緑の帽子。A「私は赤じゃない」B「私は青」C「私は緑じゃない」。1人だけ嘘つき。Cの帽子の色は？",
         [{"id":"A","text":"赤"},{"id":"B","text":"青"},{"id":"C","text":"緑"},{"id":"D","text":"不明"}],
         [2], "推理", "4", 15, "Cが嘘つきなら緑", "帽子パズル"),
        
        ("5人でリレー。AはCより速く、BはDより遅く、CはEより速い。EはDより速い。最も速いのは？",
         [{"id":"A","text":"A"},{"id":"B","text":"B"},{"id":"C","text":"C"},{"id":"D","text":"E"}],
         [0], "推理", "3", 12, "A>C>E>D>B", "順序推理"),
        
        ("4枚のカード「A・B・2・3」。「母音の裏は偶数」を確認するには？",
         [{"id":"A","text":"AとB"},{"id":"B","text":"Aと2"},{"id":"C","text":"Aと3"},{"id":"D","text":"全部"}],
         [2], "推理", "4", 18, "Aの裏と、3の裏を確認", "ウェイソン選択課題"),
        
        ("3つのスイッチ、1つが電球。1回だけ部屋に入れる。どう確認？",
         [{"id":"A","text":"1番をON"},{"id":"B","text":"1番ON→5分後OFF→2番ON"},{"id":"C","text":"全部ON"},{"id":"D","text":"不可能"}],
         [1], "推理", "4", 20, "熱で判別", "電球パズル"),
        
        ("3つの箱：金だけ、銀だけ、金銀混合。全てラベルが間違い。1枚だけコインを見て全て当てるには？",
         [{"id":"A","text":"「金だけ」の箱"},{"id":"B","text":"「銀だけ」の箱"},{"id":"C","text":"「混合」の箱"},{"id":"D","text":"不可能"}],
         [2], "推理", "5", 20, "混合ラベルから取る", "ラベルパズル"),
        
        ("12個の玉、1個だけ重さが違う。天秤3回で特定するには？",
         [{"id":"A","text":"可能"},{"id":"B","text":"不可能"},{"id":"C","text":"4回必要"},{"id":"D","text":"5回必要"}],
         [0], "推理", "5", 22, "3分割法を使う", "天秤パズル"),
        
        ("100人の村。A「私以外全員嘘つき」。何人が正直者？",
         [{"id":"A","text":"1人"},{"id":"B","text":"0人"},{"id":"C","text":"99人"},{"id":"D","text":"不明"}],
         [0], "推理", "3", 12, "Aだけが正直者", "自己言及"),
        
        ("赤青黄の3つの扉。赤の扉「宝は青の扉」青の扉「宝はここ」黄の扉「宝は赤の扉にない」。1つだけ正直。宝は？",
         [{"id":"A","text":"赤"},{"id":"B","text":"青"},{"id":"C","text":"黄"},{"id":"D","text":"不明"}],
         [2], "推理", "4", 15, "黄の扉が正直なら整合", "扉パズル"),
        
        ("犯人はA,B,Cの誰か。A「Bが犯人」B「Cが犯人」C「私は無実」。犯人1人で他2人は正直。犯人は？",
         [{"id":"A","text":"A"},{"id":"B","text":"B"},{"id":"C","text":"C"},{"id":"D","text":"不明"}],
         [1], "推理", "3", 12, "Bが犯人なら矛盾なし", "犯人推理"),
        
        ("5人が円卓。AはBの隣でない、CはDの隣、EはAの隣。BとDの関係は？",
         [{"id":"A","text":"隣"},{"id":"B","text":"向かい"},{"id":"C","text":"隣の隣"},{"id":"D","text":"不明"}],
         [0], "推理", "4", 15, "配置を考える", "座席配置"),
        
        ("A,B,Cが試合。勝者は次の人と対戦。AがBに勝ち、次にCに負けた。2試合目は？",
         [{"id":"A","text":"AvsB"},{"id":"B","text":"AvsC"},{"id":"C","text":"BvsC"},{"id":"D","text":"不明"}],
         [1], "推理", "2", 10, "Aが勝ったので次はC", "試合推理"),
        
        ("4人のうち2人が双子。A「私はBの兄弟じゃない」B「私はCの兄弟」C「私はDの兄弟じゃない」D「私はAの兄弟」。双子は？",
         [{"id":"A","text":"AとD"},{"id":"B","text":"BとC"},{"id":"C","text":"CとD"},{"id":"D","text":"AとB"}],
         [1], "推理", "3", 15, "Bの証言から", "家族推理"),
        
        ("5枚のカードの合計は50。平均は10。中央値は11。最小は8。2番目に小さい数は？",
         [{"id":"A","text":"9"},{"id":"B","text":"10"},{"id":"C","text":"11"},{"id":"D","text":"不明"}],
         [0], "推理", "3", 15, "8,9,11,x,yで調整", "数値推理"),
        
        ("ある規則で時計の針を進める。3時→6時→10時→？",
         [{"id":"A","text":"1時"},{"id":"B","text":"3時"},{"id":"C","text":"2時"},{"id":"D","text":"4時"}],
         [0], "推理", "3", 12, "+3,+4,+3のパターン", "時計パズル"),
    ]
    
    questions.extend(reasoning_games)
    print(f"  ✓ 推理ゲーム: {len(reasoning_games)}問")
    
    # ==================== マトリックス推論（10問） ====================
    print("[3/4] マトリックス推論問題を生成中...")
    
    matrix_questions = [
        ("3×3のマス：左上から「1,2,3/4,5,6/7,8,?」。?は？",
         [{"id":"A","text":"9"},{"id":"B","text":"10"},{"id":"C","text":"0"},{"id":"D","text":"1"}],
         [0], "マトリックス", "2", 8, "連続した数", "数列マトリックス"),
        
        ("各行の和が15：「2,5,8/?4,6/3,7,?」。2つの?の和は？",
         [{"id":"A","text":"10"},{"id":"B","text":"11"},{"id":"C","text":"12"},{"id":"D","text":"13"}],
         [1], "マトリックス", "3", 12, "5+6=11", "合計マトリックス"),
        
        ("対角線の積が等しい：「2,3,4/5,6,7/8,9,?」。?は？",
         [{"id":"A","text":"10"},{"id":"B","text":"12"},{"id":"C","text":"15"},{"id":"D","text":"18"}],
         [2], "マトリックス", "4", 15, "2×6×?=4×6×5", "対角線規則"),
        
        ("2×2マス、各数は周囲の和：「1,2/3,?」。?は？",
         [{"id":"A","text":"4"},{"id":"B","text":"5"},{"id":"C","text":"6"},{"id":"D","text":"3"}],
         [2], "マトリックス", "2", 10, "1+2+3=6", "周囲和"),
        
        ("回転パターン：○が時計回りに移動。次は？",
         [{"id":"A","text":"右上"},{"id":"B","text":"右下"},{"id":"C","text":"左下"},{"id":"D","text":"中央"}],
         [1], "マトリックス", "3", 12, "時計回り規則", "図形回転"),
        
        ("色パターン：赤→青→黄→赤→青→?",
         [{"id":"A","text":"黄"},{"id":"B","text":"赤"},{"id":"C","text":"青"},{"id":"D","text":"緑"}],
         [0], "マトリックス", "2", 8, "3色の繰り返し", "色パターン"),
        
        ("各列の積が等しい：「2,3,4/1,6,?/4,?,1」。欠けた2数の積は？",
         [{"id":"A","text":"24"},{"id":"B","text":"12"},{"id":"C","text":"8"},{"id":"D","text":"6"}],
         [0], "マトリックス", "4", 18, "各列=24", "積マトリックス"),
        
        ("形状増加：△,△△,△△△,?",
         [{"id":"A","text":"△△△△"},{"id":"B","text":"△△"},{"id":"C","text":"□"},{"id":"D","text":"△△△△△"}],
         [0], "マトリックス", "2", 8, "1つずつ増加", "増加パターン"),
        
        ("魔方陣の一部：「4,9,2/?5,7/8,1,?」。?の和は？",
         [{"id":"A","text":"9"},{"id":"B","text":"10"},{"id":"C","text":"12"},{"id":"D","text":"15"}],
         [2], "マトリックス", "4", 15, "3×3魔方陣", "魔方陣"),
        
        ("2倍パターン：「1,2,4/3,6,12/?24,48」。?は？",
         [{"id":"A","text":"12"},{"id":"B","text":"8"},{"id":"C","text":"6"},{"id":"D","text":"10"}],
         [0], "マトリックス", "3", 10, "各行は2倍ずつ", "倍数マトリックス"),
    ]
    
    questions.extend(matrix_questions)
    print(f"  ✓ マトリックス推論: {len(matrix_questions)}問")
    
    # ==================== 集合論理（10問） ====================
    print("[4/4] 集合論理問題を生成中...")
    
    set_logic = [
        ("A={1,2,3}, B={2,3,4}。A∩Bは？",
         [{"id":"A","text":"{2,3}"},{"id":"B","text":"{1,2,3,4}"},{"id":"C","text":"{1,4}"},{"id":"D","text":"{2}"}],
         [0], "集合", "2", 8, "共通要素", "積集合"),
        
        ("A={1,2,3}, B={3,4,5}。A∪Bの要素数は？",
         [{"id":"A","text":"5"},{"id":"B","text":"6"},{"id":"C","text":"4"},{"id":"D","text":"7"}],
         [0], "集合", "2", 8, "{1,2,3,4,5}", "和集合"),
        
        ("全体集合U={1,2,3,4,5}, A={1,2,3}。Aの補集合は？",
         [{"id":"A","text":"{4,5}"},{"id":"B","text":"{1,2,3}"},{"id":"C","text":"{2,3,4}"},{"id":"D","text":"{5}"}],
         [0], "集合", "2", 8, "Uから Aを除く", "補集合"),
        
        ("A⊂B, B⊂C。正しいのは？",
         [{"id":"A","text":"A⊂C"},{"id":"B","text":"C⊂A"},{"id":"C","text":"A=C"},{"id":"D","text":"不明"}],
         [0], "集合", "2", 10, "推移律", "包含関係"),
        
        ("30人のクラス。数学好き20人、国語好き15人、両方好き8人。どちらも嫌いは？",
         [{"id":"A","text":"3人"},{"id":"B","text":"5人"},{"id":"C","text":"7人"},{"id":"D","text":"2人"}],
         [0], "集合", "3", 12, "30-(20+15-8)=3", "ベン図"),
        
        ("A-B（差集合）={1,2}, B-A={4,5}, A∩B={3}。A∪Bは？",
         [{"id":"A","text":"{1,2,3,4,5}"},{"id":"B","text":"{1,2,3}"},{"id":"C","text":"{3,4,5}"},{"id":"D","text":"{1,2,4,5}"}],
         [0], "集合", "3", 12, "全ての要素を合わせる", "差集合"),
        
        ("べき集合：A={1,2}のべき集合の要素数は？",
         [{"id":"A","text":"4"},{"id":"B","text":"2"},{"id":"C","text":"3"},{"id":"D","text":"8"}],
         [0], "集合", "3", 12, "2^2=4", "べき集合"),
        
        ("A×B（直積）：A={1,2}, B={3,4}。A×Bの要素数は？",
         [{"id":"A","text":"4"},{"id":"B","text":"6"},{"id":"C","text":"2"},{"id":"D","text":"8"}],
         [0], "集合", "2", 10, "2×2=4", "直積"),
        
        ("ド・モルガンの法則：(A∪B)^c = ?",
         [{"id":"A","text":"A^c ∩ B^c"},{"id":"B","text":"A^c ∪ B^c"},{"id":"C","text":"A ∩ B"},{"id":"D","text":"A ∪ B"}],
         [0], "集合", "3", 15, "ド・モルガンの法則", "補集合定理"),
        
        ("100人：英語80人、数学70人、両方60人。どちらか1つだけ？",
         [{"id":"A","text":"30人"},{"id":"B","text":"40人"},{"id":"C","text":"20人"},{"id":"D","text":"50人"}],
         [0], "集合", "3", 12, "(80-60)+(70-60)=30", "排他的論理和"),
    ]
    
    questions.extend(set_logic)
    print(f"  ✓ 集合論理: {len(set_logic)}問")
    
    # データベースに挿入
    print("データベースに保存中...")
    for q in questions:
        question_json = {
            "question": q[0],
            "options": q[1],
            "answer": q[2]
        }
        
        cursor.execute("""
            INSERT INTO questions 
            (language, question_json, category, difficulty, score, meaning, usage)
            VALUES (?, ?, ?, ?, ?, ?, ?)
        """, ("IQ", json.dumps(question_json, ensure_ascii=False), 
              q[3], q[4], q[5], q[6], q[7]))
    
    conn.commit()
    
    # 統計表示
    cursor.execute("SELECT COUNT(*) FROM questions WHERE language = 'IQ'")
    iq_count = cursor.fetchone()[0]
    
    cursor.execute("SELECT COUNT(*) FROM questions")
    total_count = cursor.fetchone()[0]
    
    conn.close()
    
    print("=" * 60)
    print("✓ IQ問題追加完了（第6弾）！")
    print("=" * 60)
    print(f"IQ問題数: {iq_count}問")
    print(f"全体問題数: {total_count}問")
    print(f"目標500問まで残り: {max(0, 500 - iq_count)}問")
    print("=" * 60)

if __name__ == "__main__":
    add_iq_batch6()