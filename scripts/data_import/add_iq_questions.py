import sqlite3
import json

DB_NAME = "SemanticGrove.db"

def add_iq_questions():
    """IQ問題を追加（50問）"""
    conn = sqlite3.connect(DB_NAME)
    cursor = conn.cursor()
    
    print("=" * 60)
    print("IQ問題追加スクリプト")
    print("=" * 60)
    
    questions = []
    
    # ==================== 数列問題（15問） ====================
    print("[1/4] 数列問題を生成中...")
    
    number_series = [
        ("次の数列で?に入る数字はどれですか？\n2, 4, 8, 16, 32, ?",
         [{"id":"A","text":"48"},{"id":"B","text":"64"},{"id":"C","text":"128"},{"id":"D","text":"256"}],
         [1], "数列", "2", 10, "2倍ずつ増加する等比数列", "規則性の発見"),
        
        ("次の数列で?に入る数字はどれですか？\n1, 1, 2, 3, 5, 8, ?",
         [{"id":"A","text":"11"},{"id":"B","text":"13"},{"id":"C","text":"15"},{"id":"D","text":"16"}],
         [1], "数列", "3", 10, "フィボナッチ数列：前2つの和", "有名な数列パターン"),
        
        ("次の数列で?に入る数字はどれですか？\n3, 6, 12, 24, 48, ?",
         [{"id":"A","text":"72"},{"id":"B","text":"84"},{"id":"C","text":"96"},{"id":"D","text":"108"}],
         [2], "数列", "2", 10, "2倍ずつ増加", "等比数列の基本"),
        
        ("次の数列で?に入る数字はどれですか？\n2, 5, 10, 17, 26, ?",
         [{"id":"A","text":"35"},{"id":"B","text":"37"},{"id":"C","text":"39"},{"id":"D","text":"41"}],
         [1], "数列", "4", 15, "差が3,5,7,9,11と増加", "階差数列"),
        
        ("次の数列で?に入る数字はどれですか？\n1, 4, 9, 16, 25, ?",
         [{"id":"A","text":"30"},{"id":"B","text":"32"},{"id":"C","text":"36"},{"id":"D","text":"49"}],
         [2], "数列", "2", 10, "平方数：1², 2², 3², 4², 5², 6²", "平方数の列"),
        
        ("次の数列で?に入る数字はどれですか？\n100, 50, 25, 12.5, ?",
         [{"id":"A","text":"6.25"},{"id":"B","text":"6"},{"id":"C","text":"5"},{"id":"D","text":"10"}],
         [0], "数列", "3", 10, "半分ずつ減少", "等比数列（減少）"),
        
        ("次の数列で?に入る数字はどれですか？\n2, 3, 5, 7, 11, ?",
         [{"id":"A","text":"12"},{"id":"B","text":"13"},{"id":"C","text":"15"},{"id":"D","text":"17"}],
         [1], "数列", "4", 15, "素数の列", "素数の認識"),
        
        ("次の数列で?に入る数字はどれですか？\n1, 8, 27, 64, 125, ?",
         [{"id":"A","text":"196"},{"id":"B","text":"216"},{"id":"C","text":"243"},{"id":"D","text":"256"}],
         [1], "数列", "4", 15, "立方数：1³, 2³, 3³, 4³, 5³, 6³", "立方数の列"),
        
        ("次の数列で?に入る数字はどれですか？\n10, 20, 15, 30, 25, ?",
         [{"id":"A","text":"35"},{"id":"B","text":"40"},{"id":"C","text":"45"},{"id":"D","text":"50"}],
         [3], "数列", "4", 15, "×2, -5を交互に繰り返す", "複合パターン"),
        
        ("次の数列で?に入る数字はどれですか？\n5, 10, 20, 40, 80, ?",
         [{"id":"A","text":"120"},{"id":"B","text":"140"},{"id":"C","text":"160"},{"id":"D","text":"180"}],
         [2], "数列", "2", 10, "2倍ずつ増加", "等比数列"),
        
        ("次の数列で?に入る数字はどれですか？\n3, 7, 15, 31, 63, ?",
         [{"id":"A","text":"127"},{"id":"B","text":"125"},{"id":"C","text":"121"},{"id":"D","text":"95"}],
         [0], "数列", "5", 20, "2倍+1を繰り返す", "複雑なパターン"),
        
        ("次の数列で?に入る数字はどれですか？\n1, 3, 7, 13, 21, ?",
         [{"id":"A","text":"29"},{"id":"B","text":"31"},{"id":"C","text":"33"},{"id":"D","text":"35"}],
         [1], "数列", "4", 15, "差が2,4,6,8,10と増加", "階差数列"),
        
        ("次の数列で?に入る数字はどれですか？\n0, 1, 1, 2, 4, 7, ?",
         [{"id":"A","text":"11"},{"id":"B","text":"12"},{"id":"C","text":"13"},{"id":"D","text":"14"}],
         [2], "数列", "5", 20, "トリボナッチ数列：前3つの和", "発展的フィボナッチ"),
        
        ("次の数列で?に入る数字はどれですか？\n256, 128, 64, 32, ?",
         [{"id":"A","text":"8"},{"id":"B","text":"12"},{"id":"C","text":"16"},{"id":"D","text":"24"}],
         [2], "数列", "2", 10, "半分ずつ減少", "等比数列（減少）"),
        
        ("次の数列で?に入る数字はどれですか？\n1, 2, 4, 7, 11, 16, ?",
         [{"id":"A","text":"20"},{"id":"B","text":"21"},{"id":"C","text":"22"},{"id":"D","text":"23"}],
         [2], "数列", "3", 10, "差が1,2,3,4,5,6と増加", "三角数関連"),
    ]
    
    for q in number_series:
        questions.append(create_question("IQ", *q))
    
    print(f"  ✓ 数列問題: {len(number_series)}問")
    
    # ==================== 論理パズル（15問） ====================
    print("[2/4] 論理パズル問題を生成中...")
    
    logic_puzzles = [
        ("AはBより背が高く、BはCより背が高い。最も背が高いのは誰ですか？",
         [{"id":"A","text":"A"},{"id":"B","text":"B"},{"id":"C","text":"C"},{"id":"D","text":"判断できない"}],
         [0], "論理", "1", 5, "推移律：A>B>Cより、Aが最大", "順序関係の推論"),
        
        ("すべての犬は動物である。ポチは犬である。したがってポチは？",
         [{"id":"A","text":"動物である"},{"id":"B","text":"猫である"},{"id":"C","text":"鳥である"},{"id":"D","text":"判断できない"}],
         [0], "論理", "2", 10, "三段論法の基本", "演繹的推論"),
        
        ("赤い箱か青い箱のどちらかに宝物が入っている。赤い箱には入っていない。宝物はどこ？",
         [{"id":"A","text":"青い箱"},{"id":"B","text":"赤い箱"},{"id":"C","text":"両方"},{"id":"D","text":"どちらでもない"}],
         [0], "論理", "1", 5, "排中律：2つのうち一方が偽なら他方が真", "基本的論理推論"),
        
        ("5人が一列に並んでいる。太郎は花子の前にいる。次郎は太郎の前にいる。最前列は誰か？\n（他の情報がない場合）",
         [{"id":"A","text":"判断できない"},{"id":"B","text":"次郎"},{"id":"C","text":"太郎"},{"id":"D","text":"花子"}],
         [0], "論理", "3", 10, "次郎が太郎より前だが、さらに前に人がいる可能性", "不完全情報からの推論"),
        
        ("Aが真実を言うとき、Bは嘘をつく。今Aが「雨が降っている」と言った。Bは何と言う？",
         [{"id":"A","text":"雨が降っていない"},{"id":"B","text":"雨が降っている"},{"id":"C","text":"判断できない"},{"id":"D","text":"晴れている"}],
         [0], "論理", "3", 10, "Aが真実ならBは嘘、逆を言う", "対立関係の推論"),
        
        ("3つの箱A,B,Cがある。1つだけ当たり。「Aは外れ」「Bは当たり」2つの情報のうち1つだけ真実。当たりはどれ？",
         [{"id":"A","text":"C"},{"id":"B","text":"A"},{"id":"C","text":"B"},{"id":"D","text":"判断できない"}],
         [0], "論理", "5", 20, "両方真ならB、両方偽ならAだが1つだけ真なのでC", "複雑な条件分岐"),
        
        ("ある会議に10人が参加。全員が他の全員と1回ずつ握手した。握手の総数は？",
         [{"id":"A","text":"45回"},{"id":"B","text":"90回"},{"id":"C","text":"100回"},{"id":"D","text":"50回"}],
         [0], "論理", "4", 15, "組み合わせ：10C2 = 45", "数え上げの論理"),
        
        ("時計が1時間に1回鳴る。12時に12回鳴る。1時に1回鳴る。24時間で合計何回鳴る？",
         [{"id":"A","text":"156回"},{"id":"B","text":"144回"},{"id":"C","text":"168回"},{"id":"D","text":"180回"}],
         [0], "論理", "4", 15, "(1+2+...+12)×2 = 78×2 = 156", "数列の和"),
        
        ("5本の異なる色のペンがある。赤の左に青がある。青の左に緑がある。最も左は？",
         [{"id":"A","text":"緑"},{"id":"B","text":"青"},{"id":"C","text":"赤"},{"id":"D","text":"判断できない"}],
         [3], "論理", "3", 10, "緑の左にさらにペンがある可能性", "不完全情報"),
        
        ("AまたはBが真。Aは偽。したがって？",
         [{"id":"A","text":"Bは真"},{"id":"B","text":"Bは偽"},{"id":"C","text":"判断できない"},{"id":"D","text":"両方真"}],
         [0], "論理", "2", 10, "選言除去：A∨Bで¬Aなら→B", "論理演算"),
        
        ("3人がじゃんけんをした。必ず誰か1人が勝つ確率は？",
         [{"id":"A","text":"1/4"},{"id":"B","text":"1/3"},{"id":"C","text":"1/2"},{"id":"D","text":"2/3"}],
         [0], "論理", "5", 20, "全27通りのうち、あいこは21通り、勝者あり6通り", "確率的推論"),
        
        ("すべての鳥は飛べる。ペンギンは鳥である。したがってペンギンは飛べる。この推論は？",
         [{"id":"A","text":"形式的に正しいが前提が誤り"},{"id":"B","text":"完全に正しい"},{"id":"C","text":"推論が誤り"},{"id":"D","text":"判断できない"}],
         [0], "論理", "4", 15, "三段論法は形式的に有効だが前提が現実と異なる", "論理の妥当性と健全性"),
        
        ("AはBの2倍の年齢。10年後、AはBの1.5倍。現在Bは何歳？",
         [{"id":"A","text":"10歳"},{"id":"B","text":"15歳"},{"id":"C","text":"20歳"},{"id":"D","text":"25歳"}],
         [0], "論理", "5", 20, "A=2B、A+10=1.5(B+10)を解くとB=10", "代数的推論"),
        
        ("4人が円卓に座る。太郎の対面に花子、花子の右に次郎。太郎の左は誰？",
         [{"id":"A","text":"次郎"},{"id":"B","text":"花子"},{"id":"C","text":"判断できない"},{"id":"D","text":"太郎"}],
         [2], "論理", "4", 15, "4人目の位置情報がない", "空間推論"),
        
        ("100mを10秒で走る人が1kmを走ると最速何秒？",
         [{"id":"A","text":"100秒以上"},{"id":"B","text":"100秒"},{"id":"C","text":"90秒"},{"id":"D","text":"110秒"}],
         [0], "論理", "3", 10, "持続力を考慮すると100秒より遅い", "現実的推論"),
    ]
    
    for q in logic_puzzles:
        questions.append(create_question("IQ", *q))
    
    print(f"  ✓ 論理パズル: {len(logic_puzzles)}問")
    
    # ==================== 言語推理（10問） ====================
    print("[3/4] 言語推理問題を生成中...")
    
    verbal_reasoning = [
        ("「犬：哺乳類」の関係と同じものはどれですか？",
         [{"id":"A","text":"バラ：植物"},{"id":"B","text":"赤：色"},{"id":"C","text":"車：タイヤ"},{"id":"D","text":"本：紙"}],
         [0], "言語", "2", 10, "犬は哺乳類の一種、バラは植物の一種", "上位概念と下位概念"),
        
        ("「医者：病院」の関係と同じものはどれですか？",
         [{"id":"A","text":"教師：学校"},{"id":"B","text":"患者：薬"},{"id":"C","text":"看護師：注射"},{"id":"D","text":"手術：メス"}],
         [0], "言語", "2", 10, "職業と勤務場所の関係", "対応関係"),
        
        ("次のうち仲間外れはどれですか？\nリンゴ、バナナ、ニンジン、ミカン",
         [{"id":"A","text":"ニンジン"},{"id":"B","text":"リンゴ"},{"id":"C","text":"バナナ"},{"id":"D","text":"ミカン"}],
         [0], "言語", "2", 10, "ニンジンだけ野菜、他は果物", "分類能力"),
        
        ("「大きい」の反対語はどれですか？",
         [{"id":"A","text":"小さい"},{"id":"B","text":"低い"},{"id":"C","text":"軽い"},{"id":"D","text":"細い"}],
         [0], "言語", "1", 5, "サイズの対義語", "対義語の理解"),
        
        ("「海：水」の関係と同じものはどれですか？",
         [{"id":"A","text":"砂漠：砂"},{"id":"B","text":"森：木"},{"id":"C","text":"両方正しい"},{"id":"D","text":"山：石"}],
         [2], "言語", "3", 10, "主要な構成要素の関係", "構成要素の類推"),
        
        ("次のうち「楽器」でないものはどれですか？",
         [{"id":"A","text":"スピーカー"},{"id":"B","text":"ピアノ"},{"id":"C","text":"ギター"},{"id":"D","text":"バイオリン"}],
         [0], "言語", "2", 10, "スピーカーは音を出すが楽器ではない", "カテゴリー分類"),
        
        ("「原因：結果」の関係と同じものはどれですか？",
         [{"id":"A","text":"雨：濡れる"},{"id":"B","text":"太陽：明るい"},{"id":"C","text":"風：寒い"},{"id":"D","text":"雪：白い"}],
         [0], "言語", "3", 10, "因果関係", "因果推論"),
        
        ("「本：ページ」の関係と同じものはどれですか？",
         [{"id":"A","text":"時計：針"},{"id":"B","text":"ペン：インク"},{"id":"C","text":"机：椅子"},{"id":"D","text":"窓：ガラス"}],
         [0], "言語", "3", 10, "全体と部分の関係", "包含関係"),
        
        ("次の単語の共通点は何ですか？\n犬、猫、象、ライオン",
         [{"id":"A","text":"動物"},{"id":"B","text":"ペット"},{"id":"C","text":"哺乳類"},{"id":"D","text":"4本足"}],
         [2], "言語", "3", 10, "すべて哺乳類（動物はより広い）", "最適な分類"),
        
        ("「親：子」の関係と同じものはどれですか？",
         [{"id":"A","text":"先生：生徒"},{"id":"B","text":"兄：弟"},{"id":"C","text":"友人：友人"},{"id":"D","text":"夫：妻"}],
         [0], "言語", "3", 10, "指導・被指導の関係", "役割関係"),
    ]
    
    for q in verbal_reasoning:
        questions.append(create_question("IQ", *q))
    
    print(f"  ✓ 言語推理: {len(verbal_reasoning)}問")
    
    # ==================== 図形・パターン（10問） ====================
    print("[4/4] 図形・パターン問題を生成中...")
    
    pattern_recognition = [
        ("次のパターンで?に入る図形の特徴は？\n○○○ △△△ □□□ ?",
         [{"id":"A","text":"同じ図形が3つ"},{"id":"B","text":"異なる図形"},{"id":"C","text":"2つの図形"},{"id":"D","text":"4つの図形"}],
         [0], "図形", "2", 10, "同じ図形が3つ並ぶパターン", "繰り返しパターン"),
        
        ("1個、2個、3個、4個...と増えていくパターン。次は何個？",
         [{"id":"A","text":"5個"},{"id":"B","text":"6個"},{"id":"C","text":"8個"},{"id":"D","text":"10個"}],
         [0], "図形", "1", 5, "1ずつ増加", "単純増加パターン"),
        
        ("○→●→○→●のパターン。次は？",
         [{"id":"A","text":"○"},{"id":"B","text":"●"},{"id":"C","text":"△"},{"id":"D","text":"□"}],
         [0], "図形", "1", 5, "白黒交互", "交互パターン"),
        
        ("△、▽、△、▽のパターン。これは何の繰り返し？",
         [{"id":"A","text":"上下反転"},{"id":"B","text":"左右反転"},{"id":"C","text":"回転"},{"id":"D","text":"拡大縮小"}],
         [0], "図形", "2", 10, "上向き下向きの交互", "反転パターン"),
        
        ("1つ、2つ、4つ、8つと増えるパターン。次は？",
         [{"id":"A","text":"16個"},{"id":"B","text":"12個"},{"id":"C","text":"10個"},{"id":"D","text":"15個"}],
         [0], "図形", "3", 10, "2倍ずつ増加", "等比的増加"),
        
        ("○、○○、○○○のパターン。5番目は何個？",
         [{"id":"A","text":"5個"},{"id":"B","text":"10個"},{"id":"C","text":"15個"},{"id":"D","text":"20個"}],
         [0], "図形", "2", 10, "1個ずつ増加", "算術数列"),
        
        ("時計回りに90度ずつ回転するパターン。4回回転後は？",
         [{"id":"A","text":"元の位置"},{"id":"B","text":"90度回転"},{"id":"C","text":"180度回転"},{"id":"D","text":"270度回転"}],
         [0], "図形", "3", 10, "90×4=360度で1回転", "回転の理解"),
        
        ("正方形が1段、2段、3段と積み上がる。4段目は全部で何個？",
         [{"id":"A","text":"10個"},{"id":"B","text":"8個"},{"id":"C","text":"16個"},{"id":"D","text":"20個"}],
         [0], "図形", "4", 15, "1+2+3+4=10個", "三角数"),
        
        ("○●○●○のパターン。6番目は？",
         [{"id":"A","text":"●"},{"id":"B","text":"○"},{"id":"C","text":"判断できない"},{"id":"D","text":"両方"}],
         [0], "図形", "2", 10, "奇数位置が○、偶数位置が●", "位置パターン"),
        
        ("△が時計回りに45度ずつ回転。8回回転後は？",
         [{"id":"A","text":"元の位置"},{"id":"B","text":"90度"},{"id":"C","text":"180度"},{"id":"D","text":"270度"}],
         [0], "図形", "4", 15, "45×8=360度で1回転", "角度計算"),
    ]
    
    for q in pattern_recognition:
        questions.append(create_question("IQ", *q))
    
    print(f"  ✓ 図形・パターン: {len(pattern_recognition)}問")
    
    # データベースに保存
    print("\nデータベースに保存中...")
    
    for q in questions:
        cursor.execute("""
            INSERT INTO questions (language, question_json, category, difficulty, score, meaning, usage)
            VALUES (?, ?, ?, ?, ?, ?, ?)
        """, q)
    
    conn.commit()
    
    # 最終集計
    cursor.execute("SELECT language, COUNT(*) FROM questions GROUP BY language ORDER BY language")
    final_stats = cursor.fetchall()
    
    print("\n" + "=" * 60)
    print("✓ IQ問題追加完了！")
    print("=" * 60)
    print("\n最終問題数:")
    total = 0
    for lang, count in final_stats:
        print(f"  {lang:15} : {count:3}問")
        total += count
    print("-" * 40)
    print(f"  {'合計':15} : {total:3}問")
    print("=" * 60)
    
    conn.close()


def create_question(language, question, options, answer, category, difficulty, score, meaning, usage):
    """問題データを作成"""
    return (
        language,
        json.dumps({
            'question': question,
            'options': options,
            'answer': answer
        }, ensure_ascii=False),
        category,
        difficulty,
        score,
        meaning,
        usage
    )


if __name__ == "__main__":
    add_iq_questions()