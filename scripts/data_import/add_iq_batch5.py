import sqlite3
import json

DB_NAME = "SemanticGrove.db"

def add_iq_batch5():
    """IQ問題追加（第5弾・50問）"""
    conn = sqlite3.connect(DB_NAME)
    cursor = conn.cursor()
    
    print("=" * 60)
    print("IQ問題追加スクリプト（第5弾）")
    print("=" * 60)
    
    questions = []
    
    # ==================== 論理推論（15問） ====================
    print("[1/4] 論理推論問題を生成中...")
    
    logic_questions = [
        ("全てのAはB。全てのBはC。よって全てのAは？",
         [{"id":"A","text":"C"},{"id":"B","text":"B"},{"id":"C","text":"D"},{"id":"D","text":"不明"}],
         [0], "論理推論", "2", 8, "三段論法", "演繹推論"),
        
        ("AまたはBが真。Aが偽。よってBは？",
         [{"id":"A","text":"真"},{"id":"B","text":"偽"},{"id":"C","text":"不明"},{"id":"D","text":"真または偽"}],
         [0], "論理推論", "2", 8, "選言三段論法", "論理OR"),
        
        ("もしAならばB。Bが偽。よってAは？",
         [{"id":"A","text":"偽"},{"id":"B","text":"真"},{"id":"C","text":"不明"},{"id":"D","text":"真または偽"}],
         [0], "論理推論", "3", 10, "否定後件", "対偶"),
        
        ("AかつBが真。よってAは？",
         [{"id":"A","text":"真"},{"id":"B","text":"偽"},{"id":"C","text":"不明"},{"id":"D","text":"真または偽"}],
         [0], "論理推論", "2", 8, "連言除去", "論理AND"),
        
        ("もしAならばB。Aが真。よってBは？",
         [{"id":"A","text":"真"},{"id":"B","text":"偽"},{"id":"C","text":"不明"},{"id":"D","text":"真または偽"}],
         [0], "論理推論", "2", 8, "前件肯定", "modus ponens"),
        
        ("医者でない人は全員看護師。太郎は看護師でない。太郎は？",
         [{"id":"A","text":"医者"},{"id":"B","text":"看護師"},{"id":"C","text":"どちらでもない"},{"id":"D","text":"不明"}],
         [0], "論理推論", "3", 10, "対偶を使う", "否定推論"),
        
        ("A→B、B→C、C→D。Aが真ならDは？",
         [{"id":"A","text":"真"},{"id":"B","text":"偽"},{"id":"C","text":"不明"},{"id":"D","text":"真または偽"}],
         [0], "論理推論", "3", 10, "推移律の連鎖", "推移的推論"),
        
        ("赤か青のどちらか。赤でない。よって？",
         [{"id":"A","text":"青"},{"id":"B","text":"赤"},{"id":"C","text":"どちらでもない"},{"id":"D","text":"不明"}],
         [0], "論理推論", "2", 8, "排中律", "二値論理"),
        
        ("AならばB。BならばC。CならばA。Aが偽ならBは？",
         [{"id":"A","text":"偽"},{"id":"B","text":"真"},{"id":"C","text":"不明"},{"id":"D","text":"真または偽"}],
         [0], "論理推論", "4", 15, "循環論理", "等価関係"),
        
        ("全ての猫は動物。ポチは動物でない。ポチは？",
         [{"id":"A","text":"猫ではない"},{"id":"B","text":"猫"},{"id":"C","text":"不明"},{"id":"D","text":"犬"}],
         [0], "論理推論", "3", 10, "否定後件", "除外推論"),
        
        ("もしAならばBかC。Bが偽、Cが偽。よってAは？",
         [{"id":"A","text":"偽"},{"id":"B","text":"真"},{"id":"C","text":"不明"},{"id":"D","text":"真または偽"}],
         [0], "論理推論", "3", 12, "選言の否定", "ド・モルガン"),
        
        ("AとBは両方真か両方偽。Aが真。Bは？",
         [{"id":"A","text":"真"},{"id":"B","text":"偽"},{"id":"C","text":"不明"},{"id":"D","text":"真または偽"}],
         [0], "論理推論", "2", 8, "同値関係", "等価命題"),
        
        ("少なくとも1人は嘘つき。全員正直者は矛盾。よって？",
         [{"id":"A","text":"1人以上嘘つき"},{"id":"B","text":"全員嘘つき"},{"id":"C","text":"半分嘘つき"},{"id":"D","text":"不明"}],
         [0], "論理推論", "3", 10, "存在量化", "存在命題"),
        
        ("XかYが必要。Xがない。よって？",
         [{"id":"A","text":"Yが必要"},{"id":"B","text":"Yは不要"},{"id":"C","text":"不明"},{"id":"D","text":"どちらも不要"}],
         [0], "論理推論", "2", 8, "必要条件", "選言消去"),
        
        ("もしAならばBでない。Bが真。よってAは？",
         [{"id":"A","text":"偽"},{"id":"B","text":"真"},{"id":"C","text":"不明"},{"id":"D","text":"真または偽"}],
         [0], "論理推論", "3", 10, "否定の対偶", "否定推論"),
    ]
    
    questions.extend(logic_questions)
    print(f"  ✓ 論理推論: {len(logic_questions)}問")
    
    # ==================== 数列パターン（15問） ====================
    print("[2/4] 数列パターン問題を生成中...")
    
    sequence_questions = [
        ("2, 4, 8, 16, ?",
         [{"id":"A","text":"32"},{"id":"B","text":"24"},{"id":"C","text":"20"},{"id":"D","text":"30"}],
         [0], "数列", "2", 8, "2倍ずつ", "等比数列"),
        
        ("1, 1, 2, 3, 5, 8, ?",
         [{"id":"A","text":"13"},{"id":"B","text":"11"},{"id":"C","text":"10"},{"id":"D","text":"12"}],
         [0], "数列", "3", 10, "フィボナッチ数列", "加算数列"),
        
        ("3, 6, 12, 24, ?",
         [{"id":"A","text":"48"},{"id":"B","text":"36"},{"id":"C","text":"30"},{"id":"D","text":"42"}],
         [0], "数列", "2", 8, "2倍ずつ", "等比数列"),
        
        ("1, 4, 9, 16, 25, ?",
         [{"id":"A","text":"36"},{"id":"B","text":"30"},{"id":"C","text":"35"},{"id":"D","text":"40"}],
         [0], "数列", "2", 8, "平方数", "二乗数列"),
        
        ("2, 5, 10, 17, 26, ?",
         [{"id":"A","text":"37"},{"id":"B","text":"35"},{"id":"C","text":"38"},{"id":"D","text":"36"}],
         [0], "数列", "3", 12, "n²+1のパターン", "多項式数列"),
        
        ("5, 10, 20, 35, 55, ?",
         [{"id":"A","text":"80"},{"id":"B","text":"75"},{"id":"C","text":"85"},{"id":"D","text":"90"}],
         [0], "数列", "4", 15, "差が+5,+10,+15,+20,+25", "階差数列"),
        
        ("1, 3, 7, 15, 31, ?",
         [{"id":"A","text":"63"},{"id":"B","text":"62"},{"id":"C","text":"64"},{"id":"D","text":"60"}],
         [0], "数列", "3", 12, "2倍+1のパターン", "指数数列"),
        
        ("100, 50, 25, 12.5, ?",
         [{"id":"A","text":"6.25"},{"id":"B","text":"6"},{"id":"C","text":"5"},{"id":"D","text":"10"}],
         [0], "数列", "2", 8, "半分ずつ", "等比数列"),
        
        ("2, 3, 5, 7, 11, ?",
         [{"id":"A","text":"13"},{"id":"B","text":"15"},{"id":"C","text":"12"},{"id":"D","text":"14"}],
         [0], "数列", "3", 10, "素数", "素数列"),
        
        ("1, 8, 27, 64, ?",
         [{"id":"A","text":"125"},{"id":"B","text":"100"},{"id":"C","text":"81"},{"id":"D","text":"120"}],
         [0], "数列", "3", 10, "立方数(1³,2³,3³...)", "三乗数列"),
        
        ("0, 1, 1, 2, 4, 7, 13, ?",
         [{"id":"A","text":"24"},{"id":"B","text":"20"},{"id":"C","text":"21"},{"id":"D","text":"23"}],
         [0], "数列", "4", 15, "トリボナッチ数列", "三項加算"),
        
        ("6, 12, 24, 48, ?",
         [{"id":"A","text":"96"},{"id":"B","text":"72"},{"id":"C","text":"84"},{"id":"D","text":"90"}],
         [0], "数列", "2", 8, "2倍ずつ", "等比数列"),
        
        ("10, 20, 15, 30, 25, ?",
         [{"id":"A","text":"50"},{"id":"B","text":"35"},{"id":"C","text":"40"},{"id":"D","text":"45"}],
         [0], "数列", "3", 12, "×2, -5の繰り返し", "交互数列"),
        
        ("3, 9, 27, 81, ?",
         [{"id":"A","text":"243"},{"id":"B","text":"162"},{"id":"C","text":"200"},{"id":"D","text":"240"}],
         [0], "数列", "2", 8, "3倍ずつ", "等比数列"),
        
        ("1, 2, 4, 7, 11, 16, ?",
         [{"id":"A","text":"22"},{"id":"B","text":"21"},{"id":"C","text":"20"},{"id":"D","text":"23"}],
         [0], "数列", "3", 10, "差が+1,+2,+3,+4,+5,+6", "三角数の変形"),
    ]
    
    questions.extend(sequence_questions)
    print(f"  ✓ 数列パターン: {len(sequence_questions)}問")
    
    # ==================== 空間認識（10問） ====================
    print("[3/4] 空間認識問題を生成中...")
    
    spatial_questions = [
        ("立方体を真上から見ると？",
         [{"id":"A","text":"正方形"},{"id":"B","text":"長方形"},{"id":"C","text":"円"},{"id":"D","text":"三角形"}],
         [0], "空間認識", "2", 8, "真上からは正方形", "投影図"),
        
        ("円柱を横から見ると？",
         [{"id":"A","text":"長方形"},{"id":"B","text":"円"},{"id":"C","text":"楕円"},{"id":"D","text":"三角形"}],
         [0], "空間認識", "2", 8, "横からは長方形", "側面図"),
        
        ("正方形を対角線で折ると？",
         [{"id":"A","text":"三角形"},{"id":"B","text":"長方形"},{"id":"C","text":"台形"},{"id":"D","text":"平行四辺形"}],
         [0], "空間認識", "2", 8, "二等辺三角形", "折り紙"),
        
        ("立方体の展開図。向かい合う面の数字の和が7。1の向かいは？",
         [{"id":"A","text":"6"},{"id":"B","text":"5"},{"id":"C","text":"4"},{"id":"D","text":"3"}],
         [0], "空間認識", "3", 10, "サイコロの法則", "展開図"),
        
        ("鏡に映った「AMBULANCE」は？",
         [{"id":"A","text":"ECNALUBMA"},{"id":"B","text":"AMBULANCE"},{"id":"C","text":"ƎƆИA⅃UBMA"},{"id":"D","text":"逆さま"}],
         [0], "空間認識", "2", 8, "左右反転", "鏡像"),
        
        ("時計の針が3時を指している。鏡に映ると？",
         [{"id":"A","text":"9時"},{"id":"B","text":"3時"},{"id":"C","text":"6時"},{"id":"D","text":"12時"}],
         [0], "空間認識", "3", 10, "左右対称", "時計の鏡像"),
        
        ("正四面体の面の数は？",
         [{"id":"A","text":"4"},{"id":"B","text":"3"},{"id":"C","text":"5"},{"id":"D","text":"6"}],
         [0], "空間認識", "2", 8, "正四面体は4面", "多面体"),
        
        ("立方体を斜めに切ると断面は？",
         [{"id":"A","text":"六角形"},{"id":"B","text":"正方形"},{"id":"C","text":"長方形"},{"id":"D","text":"三角形"}],
         [0], "空間認識", "4", 15, "斜め切断で六角形", "断面図"),
        
        ("円錐を真横から見ると？",
         [{"id":"A","text":"三角形"},{"id":"B","text":"円"},{"id":"C","text":"楕円"},{"id":"D","text":"長方形"}],
         [0], "空間認識", "2", 8, "側面は三角形", "投影図"),
        
        ("正六面体（立方体）の頂点の数は？",
         [{"id":"A","text":"8"},{"id":"B","text":"6"},{"id":"C","text":"12"},{"id":"D","text":"10"}],
         [0], "空間認識", "2", 8, "立方体は8頂点", "多面体の性質"),
    ]
    
    questions.extend(spatial_questions)
    print(f"  ✓ 空間認識: {len(spatial_questions)}問")
    
    # ==================== 組み合わせ最適化（10問） ====================
    print("[4/4] 組み合わせ最適化問題を生成中...")
    
    optimization_questions = [
        ("3人を2つのグループに分ける方法は？",
         [{"id":"A","text":"3通り"},{"id":"B","text":"4通り"},{"id":"C","text":"6通り"},{"id":"D","text":"2通り"}],
         [0], "組み合わせ", "3", 10, "C(3,1)=3通り", "組み合わせ"),
        
        ("4つから2つ選ぶ方法は？",
         [{"id":"A","text":"6通り"},{"id":"B","text":"4通り"},{"id":"C","text":"8通り"},{"id":"D","text":"12通り"}],
         [0], "組み合わせ", "2", 8, "4C2=6", "二項係数"),
        
        ("3色から2色選んで並べる方法は？",
         [{"id":"A","text":"6通り"},{"id":"B","text":"3通り"},{"id":"C","text":"9通り"},{"id":"D","text":"12通り"}],
         [0], "組み合わせ", "3", 10, "3P2=6", "順列"),
        
        ("5人が一列に並ぶ方法は？",
         [{"id":"A","text":"120通り"},{"id":"B","text":"60通り"},{"id":"C","text":"24通り"},{"id":"D","text":"100通り"}],
         [0], "組み合わせ", "3", 10, "5!=120", "階乗"),
        
        ("10人から3人選ぶ方法は？",
         [{"id":"A","text":"120通り"},{"id":"B","text":"100通り"},{"id":"C","text":"720通り"},{"id":"D","text":"30通り"}],
         [0], "組み合わせ", "3", 12, "10C3=120", "組み合わせ"),
        
        ("ABCの3文字を並べ替える方法は？",
         [{"id":"A","text":"6通り"},{"id":"B","text":"3通り"},{"id":"C","text":"9通り"},{"id":"D","text":"12通り"}],
         [0], "組み合わせ", "2", 8, "3!=6", "順列"),
        
        ("赤玉3個、青玉2個を並べる方法は？",
         [{"id":"A","text":"10通り"},{"id":"B","text":"20通り"},{"id":"C","text":"6通り"},{"id":"D","text":"12通り"}],
         [0], "組み合わせ", "4", 15, "5!/(3!×2!)=10", "重複順列"),
        
        ("6人から委員長・副委員長を選ぶ方法は？",
         [{"id":"A","text":"30通り"},{"id":"B","text":"15通り"},{"id":"C","text":"36通り"},{"id":"D","text":"20通り"}],
         [0], "組み合わせ", "3", 10, "6P2=30", "順列"),
        
        ("コイン3枚を投げる結果は？",
         [{"id":"A","text":"8通り"},{"id":"B","text":"6通り"},{"id":"C","text":"9通り"},{"id":"D","text":"12通り"}],
         [0], "組み合わせ", "2", 8, "2³=8", "2の累乗"),
        
        ("5つの都市を巡る最短経路（始点固定）の候補数は？",
         [{"id":"A","text":"24通り"},{"id":"B","text":"120通り"},{"id":"C","text":"60通り"},{"id":"D","text":"20通り"}],
         [0], "組み合わせ", "4", 15, "4!=24（始点固定）", "巡回セールスマン"),
    ]
    
    questions.extend(optimization_questions)
    print(f"  ✓ 組み合わせ最適化: {len(optimization_questions)}問")
    
    # データベースに挿入
    print("データベースに保存中...")
    for q in questions:
        question_json = {
            "question": q[0],
            "options": q[1],
            "answer": q[2]
        }
        
        cursor.execute("""
            INSERT INTO questions 
            (language, question_json, category, difficulty, score, meaning, usage)
            VALUES (?, ?, ?, ?, ?, ?, ?)
        """, ("IQ", json.dumps(question_json, ensure_ascii=False), 
              q[3], q[4], q[5], q[6], q[7]))
    
    conn.commit()
    
    # 統計表示
    cursor.execute("SELECT COUNT(*) FROM questions WHERE language = 'IQ'")
    iq_count = cursor.fetchone()[0]
    
    cursor.execute("SELECT COUNT(*) FROM questions")
    total_count = cursor.fetchone()[0]
    
    conn.close()
    
    print("=" * 60)
    print("✓ IQ問題追加完了（第5弾）！")
    print("=" * 60)
    print(f"IQ問題数: {iq_count}問")
    print(f"全体問題数: {total_count}問")
    print(f"目標500問まで残り: {max(0, 500 - iq_count)}問")
    print("=" * 60)

if __name__ == "__main__":
    add_iq_batch5()