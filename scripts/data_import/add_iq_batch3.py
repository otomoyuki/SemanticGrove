import sqlite3
import json

DB_NAME = "SemanticGrove.db"

def add_iq_batch3():
    """IQ問題追加（第3弾・50問・完全オリジナル）"""
    conn = sqlite3.connect(DB_NAME)
    cursor = conn.cursor()
    
    print("=" * 60)
    print("IQ問題追加スクリプト（第3弾）")
    print("=" * 60)
    
    questions = []
    
    # ==================== 空間認識問題（15問） ====================
    print("[1/4] 空間認識問題を生成中...")
    
    spatial_reasoning = [
        ("立方体を真上から見たとき、見える面は何個ですか？",
         [{"id":"A","text":"1個"},{"id":"B","text":"2個"},{"id":"C","text":"3個"},{"id":"D","text":"4個"}],
         [0], "空間認識", "2", 10, "真上からは上面のみ見える", "視点と可視面の理解"),
        
        ("立方体の頂点の数はいくつですか？",
         [{"id":"A","text":"8個"},{"id":"B","text":"6個"},{"id":"C","text":"12個"},{"id":"D","text":"10個"}],
         [0], "空間認識", "2", 10, "立方体は8つの頂点を持つ", "立体図形の基本"),
        
        ("立方体を斜めの平面で切断したとき、断面の形で不可能なものは？",
         [{"id":"A","text":"円"},{"id":"B","text":"三角形"},{"id":"C","text":"四角形"},{"id":"D","text":"五角形"}],
         [0], "空間認識", "5", 20, "立方体の断面に円はできない", "立体の切断面"),
        
        ("正方形を1回折って切り、開くと十字になった。どう折った？",
         [{"id":"A","text":"半分に折った"},{"id":"B","text":"対角線に折った"},{"id":"C","text":"3等分に折った"},{"id":"D","text":"4等分に折った"}],
         [0], "空間認識", "4", 15, "半分に折って中央を切ると十字", "折り紙の展開図"),
        
        ("立方体の辺の数はいくつですか？",
         [{"id":"A","text":"12本"},{"id":"B","text":"8本"},{"id":"C","text":"6本"},{"id":"D","text":"16本"}],
         [0], "空間認識", "2", 10, "立方体は12本の辺を持つ", "立体図形の構成要素"),
        
        ("紙を半分に折り、さらに半分に折った。全部で何重？",
         [{"id":"A","text":"4重"},{"id":"B","text":"2重"},{"id":"C","text":"3重"},{"id":"D","text":"8重"}],
         [0], "空間認識", "3", 10, "2回折ると2²=4重", "累乗の理解"),
        
        ("時計の長針と短針が1日に重なる回数は？（0時を含む）",
         [{"id":"A","text":"22回"},{"id":"B","text":"24回"},{"id":"C","text":"48回"},{"id":"D","text":"12回"}],
         [0], "空間認識", "5", 20, "12時間で11回×2=22回", "円運動の理解"),
        
        ("正三角形を3つの合同な図形に分割する最も単純な方法は？",
         [{"id":"A","text":"中心から頂点へ線を引く"},{"id":"B","text":"辺を3等分"},{"id":"C","text":"高さで分割"},{"id":"D","text":"不可能"}],
         [0], "空間認識", "4", 15, "中心から各頂点に線で3つの合同三角形", "図形の分割"),
        
        ("立方体のサイコロで、1の反対面が6のとき、2の反対面は？（隣接面の和が7）",
         [{"id":"A","text":"5"},{"id":"B","text":"4"},{"id":"C","text":"3"},{"id":"D","text":"判断できない"}],
         [0], "空間認識", "3", 10, "向かい合う面の和が7", "サイコロの規則性"),
        
        ("正方形の紙を対角線で2回折ると何個の層ができる？",
         [{"id":"A","text":"4層"},{"id":"B","text":"8層"},{"id":"C","text":"16層"},{"id":"D","text":"2層"}],
         [0], "空間認識", "3", 10, "対角線折りでも2²=4層", "折り紙の重なり"),
        
        ("6面体のサイコロで、1,2,3が見える角度から見たとき、見えない面の目の合計は？",
         [{"id":"A","text":"15"},{"id":"B","text":"12"},{"id":"C","text":"9"},{"id":"D","text":"21"}],
         [0], "空間認識", "4", 15, "(4+5+6)=15、または21-6=15", "補数の計算"),
        
        ("円を中心を通る直線で4等分するには何本の線が必要？",
         [{"id":"A","text":"2本"},{"id":"B","text":"4本"},{"id":"C","text":"1本"},{"id":"D","text":"3本"}],
         [0], "空間認識", "3", 10, "中心を通る2本の垂直な直径", "円の分割"),
        
        ("立方体を頂点を通る平面で切断したとき、最大で何角形の断面ができる？",
         [{"id":"A","text":"六角形"},{"id":"B","text":"五角形"},{"id":"C","text":"四角形"},{"id":"D","text":"三角形"}],
         [0], "空間認識", "5", 20, "各面を通過すると最大6面→六角形", "立体切断の応用"),
        
        ("正方形を1回折ってハサミで1回切り、開いたら2つの穴ができた。どう切った？",
         [{"id":"A","text":"折り目に平行"},{"id":"B","text":"折り目に垂直"},{"id":"C","text":"斜め"},{"id":"D","text":"不可能"}],
         [0], "空間認識", "4", 15, "折り目に平行に切ると2つの穴", "対称性の理解"),
        
        ("球を真横から見た形は？",
         [{"id":"A","text":"円"},{"id":"B","text":"楕円"},{"id":"C","text":"球"},{"id":"D","text":"半円"}],
         [0], "空間認識", "2", 10, "どの角度から見ても円", "投影図の理解"),
    ]
    
    for q in spatial_reasoning:
        questions.append(create_question("IQ", *q))
    
    print(f"  ✓ 空間認識問題: {len(spatial_reasoning)}問")
    
    # ==================== 記憶力・パターン認識（10問） ====================
    print("[2/4] 記憶力・パターン認識問題を生成中...")
    
    memory_pattern = [
        ("アルファベットのパターン：A, C, E, G, ?。次は？",
         [{"id":"A","text":"I"},{"id":"B","text":"H"},{"id":"C","text":"J"},{"id":"D","text":"K"}],
         [0], "パターン", "3", 10, "1文字飛ばし", "アルファベット数列"),
        
        ("曜日のパターン：月、水、金、?。次は？",
         [{"id":"A","text":"日"},{"id":"B","text":"火"},{"id":"C","text":"土"},{"id":"D","text":"木"}],
         [0], "パターン", "2", 10, "1日飛ばし", "周期的パターン"),
        
        ("色の順序：赤、橙、黄、?。次は？",
         [{"id":"A","text":"緑"},{"id":"B","text":"青"},{"id":"C","text":"紫"},{"id":"D","text":"白"}],
         [0], "パターン", "3", 10, "虹の色順", "色の順序記憶"),
        
        ("季節のパターン：春、夏、秋、?、春。?は？",
         [{"id":"A","text":"冬"},{"id":"B","text":"春"},{"id":"C","text":"梅雨"},{"id":"D","text":"秋"}],
         [0], "パターン", "1", 5, "四季の循環", "周期性の理解"),
        
        ("月の大小：1月(31)、2月(28)、3月(31)、4月(?)。4月は？",
         [{"id":"A","text":"30日"},{"id":"B","text":"31日"},{"id":"C","text":"29日"},{"id":"D","text":"28日"}],
         [0], "パターン", "2", 10, "4月は30日", "暦の知識"),
        
        ("五十音のパターン：あ、か、さ、?。次は？",
         [{"id":"A","text":"た"},{"id":"B","text":"な"},{"id":"C","text":"は"},{"id":"D","text":"ま"}],
         [0], "パターン", "2", 10, "五十音の行頭", "日本語の構造"),
        
        ("音階：ド、レ、ミ、ファ、?。次は？",
         [{"id":"A","text":"ソ"},{"id":"B","text":"ラ"},{"id":"C","text":"シ"},{"id":"D","text":"ド"}],
         [0], "パターン", "1", 5, "音階の順序", "音楽の基礎知識"),
        
        ("方角：北、東、南、?。次は？",
         [{"id":"A","text":"西"},{"id":"B","text":"北"},{"id":"C","text":"北東"},{"id":"D","text":"南西"}],
         [0], "パターン", "2", 10, "時計回りの4方位", "方位の理解"),
        
        ("トランプの順：A, 2, 3, ..., J, Q, ?。次は？",
         [{"id":"A","text":"K"},{"id":"B","text":"A"},{"id":"C","text":"10"},{"id":"D","text":"1"}],
         [0], "パターン", "2", 10, "トランプの序列", "カードの知識"),
        
        ("ローマ数字：I, II, III, IV, ?。次は？",
         [{"id":"A","text":"V"},{"id":"B","text":"IIII"},{"id":"C","text":"VI"},{"id":"D","text":"X"}],
         [0], "パターン", "3", 10, "ローマ数字の5", "数の表記法"),
    ]
    
    for q in memory_pattern:
        questions.append(create_question("IQ", *q))
    
    print(f"  ✓ 記憶力・パターン: {len(memory_pattern)}問")
    
    # ==================== 高度な数列（15問） ====================
    print("[3/4] 高度な数列問題を生成中...")
    
    advanced_series = [
        ("次の数列で?に入る数字：11, 13, 17, 19, 23, ?",
         [{"id":"A","text":"29"},{"id":"B","text":"27"},{"id":"C","text":"25"},{"id":"D","text":"31"}],
         [0], "数列", "4", 15, "素数の列の続き", "素数パターン"),
        
        ("次の数列で?に入る数字：1, 11, 21, 1211, 111221, ?",
         [{"id":"A","text":"312211"},{"id":"B","text":"212211"},{"id":"C","text":"121221"},{"id":"D","text":"311221"}],
         [0], "数列", "6", 25, "Look-and-Say数列：前の数を読み上げる", "視覚的数列"),
        
        ("次の数列で?に入る数字：1, 10, 100, 1000, ?",
         [{"id":"A","text":"10000"},{"id":"B","text":"5000"},{"id":"C","text":"2000"},{"id":"D","text":"11000"}],
         [0], "数列", "2", 10, "10倍ずつ増加", "指数的増加"),
        
        ("次の数列で?に入る数字：2, 12, 36, 80, 150, ?",
         [{"id":"A","text":"252"},{"id":"B","text":"200"},{"id":"C","text":"180"},{"id":"D","text":"300"}],
         [0], "数列", "5", 20, "n³+n²+n+n", "多項式数列"),
        
        ("次の数列で?に入る数字：1, 1, 2, 6, 24, ?",
         [{"id":"A","text":"120"},{"id":"B","text":"48"},{"id":"C","text":"72"},{"id":"D","text":"96"}],
         [0], "数列", "4", 15, "階乗：0!, 1!, 2!, 3!, 4!, 5!", "階乗数列"),
        
        ("次の数列で?に入る数字：1, 4, 27, 256, ?",
         [{"id":"A","text":"3125"},{"id":"B","text":"625"},{"id":"C","text":"1024"},{"id":"D","text":"2048"}],
         [0], "数列", "5", 20, "n^n：1¹, 2², 3³, 4⁴, 5⁵", "累乗数列"),
        
        ("次の数列で?に入る数字：0, 1, 4, 9, 16, 25, ?",
         [{"id":"A","text":"36"},{"id":"B","text":"30"},{"id":"C","text":"49"},{"id":"D","text":"42"}],
         [0], "数列", "2", 10, "平方数：0², 1², 2², 3², 4², 5², 6²", "平方数"),
        
        ("次の数列で?に入る数字：2, 4, 16, 256, ?",
         [{"id":"A","text":"65536"},{"id":"B","text":"512"},{"id":"C","text":"1024"},{"id":"D","text":"4096"}],
         [0], "数列", "5", 20, "2²ⁿ：2¹, 2², 2⁴, 2⁸, 2¹⁶", "べき乗の累乗"),
        
        ("次の数列で?に入る数字：1, 3, 6, 10, 15, ?",
         [{"id":"A","text":"21"},{"id":"B","text":"18"},{"id":"C","text":"20"},{"id":"D","text":"24"}],
         [0], "数列", "3", 10, "三角数：1+2+3+4+5+6", "累積和"),
        
        ("次の数列で?に入る数字：1, 2, 2, 4, 8, 32, ?",
         [{"id":"A","text":"256"},{"id":"B","text":"64"},{"id":"C","text":"128"},{"id":"D","text":"512"}],
         [0], "数列", "6", 25, "前2つの積", "乗算フィボナッチ"),
        
        ("次の数列で?に入る数字：0, 1, 3, 6, 10, 15, 21, ?",
         [{"id":"A","text":"28"},{"id":"B","text":"27"},{"id":"C","text":"30"},{"id":"D","text":"25"}],
         [0], "数列", "3", 10, "三角数：n(n+1)/2", "組み合わせ数"),
        
        ("次の数列で?に入る数字：1, -1, 2, -2, 3, -3, ?",
         [{"id":"A","text":"4"},{"id":"B","text":"-4"},{"id":"C","text":"0"},{"id":"D","text":"3"}],
         [0], "数列", "3", 10, "正負交互で絶対値が1ずつ増加", "符号交代数列"),
        
        ("次の数列で?に入る数字：1, 3, 7, 15, 31, 63, ?",
         [{"id":"A","text":"127"},{"id":"B","text":"95"},{"id":"C","text":"125"},{"id":"D","text":"255"}],
         [0], "数列", "4", 15, "2ⁿ-1：メルセンヌ数", "指数関数-定数"),
        
        ("次の数列で?に入る数字：1, 2, 4, 8, 16, 32, ?",
         [{"id":"A","text":"64"},{"id":"B","text":"48"},{"id":"C","text":"56"},{"id":"D","text":"128"}],
         [0], "数列", "2", 10, "2の累乗", "等比数列"),
        
        ("次の数列で?に入る数字：100, 121, 144, 169, 196, ?",
         [{"id":"A","text":"225"},{"id":"B","text":"200"},{"id":"C","text":"210"},{"id":"D","text":"220"}],
         [0], "数列", "3", 10, "10²,11²,12²,13²,14²,15²", "連続平方数"),
    ]
    
    for q in advanced_series:
        questions.append(create_question("IQ", *q))
    
    print(f"  ✓ 高度な数列: {len(advanced_series)}問")
    
    # ==================== 高度な論理（10問・MENSA級） ====================
    print("[4/4] 高度な論理問題を生成中...")
    
    advanced_logic = [
        ("100人が赤か青の帽子を被る。全員同時に予想し、1人でも正解すれば全員解放。戦略は？",
         [{"id":"A","text":"1人が全員を観察して確率で判断"},{"id":"B","text":"全員ランダム"},{"id":"C","text":"交互に予想"},{"id":"D","text":"不可能"}],
         [0], "論理", "6", 25, "1人が犠牲になり残り全員確実", "協調戦略"),
        
        ("3人の賢者に白黒帽子。各自は他の2人の帽子を見て自分の色を推理。全員が推理できなければ全員賢者。帽子が白3黒2で全員白なら？",
         [{"id":"A","text":"全員が推理できる"},{"id":"B","text":"誰も推理できない"},{"id":"C","text":"1人だけ推理できる"},{"id":"D","text":"2人が推理できる"}],
         [0], "論理", "6", 25, "黒2人見たら自分は白確定だが全員白だと推理不可→それぞれ推理", "帰納的推論"),
        
        ("無限ホテルに無限人の客。各部屋に1人ずつ。無限人の新客が来た。全員泊められる？",
         [{"id":"A","text":"泊められる"},{"id":"B","text":"不可能"},{"id":"C","text":"半分だけ"},{"id":"D","text":"有限なら可能"}],
         [0], "論理", "6", 25, "各客をn→2n号室に移動で奇数室が空く", "無限の理解"),
        
        ("1000本のワインのうち1本だけ毒入り。飲んで24時間後に死ぬ。10匹のネズミで24時間以内に特定できる？",
         [{"id":"A","text":"できる"},{"id":"B","text":"不可能"},{"id":"C","text":"運次第"},{"id":"D","text":"11匹必要"}],
         [0], "論理", "6", 25, "二進法で2¹⁰=1024通り識別可能", "情報理論"),
        
        ("2つの砂時計（7分、11分）で15分を計る方法は？",
         [{"id":"A","text":"可能"},{"id":"B","text":"不可能"},{"id":"C","text":"18分かかる"},{"id":"D","text":"3つ必要"}],
         [0], "論理", "5", 20, "11-7=4分を利用した組み合わせ", "時間パズル"),
        
        ("12個の球、1個だけ重さが異なる（重いか軽いか不明）。天秤3回で特定できる？",
         [{"id":"A","text":"できる"},{"id":"B","text":"不可能"},{"id":"C","text":"4回必要"},{"id":"D","text":"運次第"}],
         [0], "論理", "6", 25, "3分割戦略で3³=27通り識別可能", "最適戦略問題"),
        
        ("100人の囚人と100個の箱。各箱に1人の名前。各囚人は50個まで開けられる。全員が自分の名前を見つければ全員解放。確率30%以上の戦略は？",
         [{"id":"A","text":"ある"},{"id":"B","text":"不可能"},{"id":"C","text":"運次第"},{"id":"D","text":"50%未満"}],
         [0], "論理", "6", 25, "サイクル追跡戦略で約31%", "確率の最適化"),
        
        ("赤青緑の帽子が各1つ以上。3人に被せる。各自は他の2人の帽子を見る。全員同時に「分からない」と言う。その後、1人が「分かった」と言う。可能？",
         [{"id":"A","text":"可能"},{"id":"B","text":"不可能"},{"id":"C","text":"情報不足"},{"id":"D","text":"矛盾"}],
         [0], "論理", "6", 25, "段階的除外で推論可能", "複雑な帰納推論"),
        
        ("島に100人の論理学者。赤目と青目がいる。自分の目の色は知らない。赤目が見えたら翌日出航。全員赤目なら何日後に全員出航？",
         [{"id":"A","text":"100日後"},{"id":"B","text":"1日後"},{"id":"C","text":"出航しない"},{"id":"D","text":"50日後"}],
         [0], "論理", "6", 25, "帰納的に100日後に全員同時に理解", "共有知識の論理"),
        
        ("2人のプレイヤーが整数を選ぶ。大きい方が勝ち。各自は相手より1大きい数を選ぶのが最適。均衡解は？",
         [{"id":"A","text":"均衡なし"},{"id":"B","text":"無限大"},{"id":"C","text":"0"},{"id":"D","text":"1"}],
         [0], "論理", "6", 25, "上限がないため純粋戦略均衡なし", "ゲーム理論のパラドックス"),
    ]
    
    for q in advanced_logic:
        questions.append(create_question("IQ", *q))
    
    print(f"  ✓ 高度な論理: {len(advanced_logic)}問")
    
    # データベースに保存
    print("\nデータベースに保存中...")
    
    for q in questions:
        cursor.execute("""
            INSERT INTO questions (language, question_json, category, difficulty, score, meaning, usage)
            VALUES (?, ?, ?, ?, ?, ?, ?)
        """, q)
    
    conn.commit()
    
    # IQ問題の集計
    cursor.execute("SELECT COUNT(*) FROM questions WHERE language = 'IQ'")
    iq_count = cursor.fetchone()[0]
    
    # 全体集計
    cursor.execute("SELECT COUNT(*) FROM questions")
    total_count = cursor.fetchone()[0]
    
    print("\n" + "=" * 60)
    print("✓ IQ問題追加完了（第3弾）！")
    print("=" * 60)
    print(f"\nIQ問題数: {iq_count}問")
    print(f"全体問題数: {total_count}問")
    print("=" * 60)
    
    conn.close()


def create_question(language, question, options, answer, category, difficulty, score, meaning, usage):
    """問題データを作成"""
    return (
        language,
        json.dumps({
            'question': question,
            'options': options,
            'answer': answer
        }, ensure_ascii=False),
        category,
        difficulty,
        score,
        meaning,
        usage
    )


if __name__ == "__main__":
    add_iq_batch3()