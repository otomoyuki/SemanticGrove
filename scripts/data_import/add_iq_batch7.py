import sqlite3
import json

DB_NAME = "SemanticGrove.db"

def add_iq_batch7():
    """IQ問題追加（第7弾・50問）"""
    conn = sqlite3.connect(DB_NAME)
    cursor = conn.cursor()
    
    print("=" * 60)
    print("IQ問題追加スクリプト（第7弾）")
    print("=" * 60)
    
    questions = []
    
    # ==================== 時間・速度計算（15問） ====================
    print("[1/4] 時間・速度計算問題を生成中...")
    
    time_speed_questions = [
        ("時速60kmで2時間走った距離は？",
         [{"id":"A","text":"120km"},{"id":"B","text":"100km"},{"id":"C","text":"80km"},{"id":"D","text":"140km"}],
         [0], "時間速度", "2", 8, "速度×時間=距離", "基本公式"),
        
        ("120kmを時速40kmで走る時間は？",
         [{"id":"A","text":"3時間"},{"id":"B","text":"2時間"},{"id":"C","text":"4時間"},{"id":"D","text":"2.5時間"}],
         [0], "時間速度", "2", 8, "距離÷速度=時間", "時間計算"),
        
        ("300kmを5時間で走る速度は？",
         [{"id":"A","text":"時速60km"},{"id":"B","text":"時速50km"},{"id":"C","text":"時速70km"},{"id":"D","text":"時速55km"}],
         [0], "時間速度", "2", 8, "距離÷時間=速度", "速度計算"),
        
        ("AとBが反対方向に時速50km、時速30kmで出発。2時間後の距離は？",
         [{"id":"A","text":"160km"},{"id":"B","text":"120km"},{"id":"C","text":"180km"},{"id":"D","text":"100km"}],
         [0], "時間速度", "3", 12, "(50+30)×2=160", "相対速度"),
        
        ("時計の長針が12から3まで動く時間は？",
         [{"id":"A","text":"15分"},{"id":"B","text":"20分"},{"id":"C","text":"30分"},{"id":"D","text":"10分"}],
         [0], "時間速度", "2", 8, "1周60分÷4=15分", "時計算"),
        
        ("川の流れ：上り時速10km、下り時速20km。静水時の速度は？",
         [{"id":"A","text":"時速15km"},{"id":"B","text":"時速12km"},{"id":"C","text":"時速18km"},{"id":"D","text":"時速14km"}],
         [0], "時間速度", "3", 12, "(上り+下り)÷2", "流水算"),
        
        ("9時から12時まで何時間？",
         [{"id":"A","text":"3時間"},{"id":"B","text":"2時間"},{"id":"C","text":"4時間"},{"id":"D","text":"2.5時間"}],
         [0], "時間速度", "1", 5, "12-9=3", "時刻計算"),
        
        ("時速72kmは秒速何m？",
         [{"id":"A","text":"20m"},{"id":"B","text":"18m"},{"id":"C","text":"25m"},{"id":"D","text":"15m"}],
         [0], "時間速度", "3", 10, "72000m÷3600秒=20", "単位変換"),
        
        ("A地点から30km離れたB地点へ時速60kmで向かう。何分かかる？",
         [{"id":"A","text":"30分"},{"id":"B","text":"20分"},{"id":"C","text":"40分"},{"id":"D","text":"25分"}],
         [0], "時間速度", "2", 8, "30÷60=0.5時間=30分", "時間単位変換"),
        
        ("池の周りを時速12kmと時速8kmで同時出発。追いつく時間は？（周長4km）",
         [{"id":"A","text":"1時間"},{"id":"B","text":"30分"},{"id":"C","text":"45分"},{"id":"D","text":"2時間"}],
         [0], "時間速度", "4", 15, "4÷(12-8)=1時間", "追いつき算"),
        
        ("往復で平均時速60km。行きが時速40km。帰りの速度は？",
         [{"id":"A","text":"時速120km"},{"id":"B","text":"時速80km"},{"id":"C","text":"時速100km"},{"id":"D","text":"時速90km"}],
         [0], "時間速度", "4", 15, "調和平均の計算", "平均速度"),
        
        ("10分で1200m進む。時速は？",
         [{"id":"A","text":"7.2km"},{"id":"B","text":"6km"},{"id":"C","text":"8km"},{"id":"D","text":"10km"}],
         [0], "時間速度", "3", 10, "1.2km×6=7.2km/h", "速度変換"),
        
        ("AがBより30分早く出発。時速60kmと80km。Bが追いつく時間は？",
         [{"id":"A","text":"1.5時間"},{"id":"B","text":"1時間"},{"id":"C","text":"2時間"},{"id":"D","text":"1.2時間"}],
         [0], "時間速度", "4", 15, "30÷(80-60)×60", "追跡算"),
        
        ("時計の短針と長針が重なるのは12時の次は？",
         [{"id":"A","text":"約1時5分"},{"id":"B","text":"1時"},{"id":"C","text":"1時10分"},{"id":"D","text":"1時15分"}],
         [0], "時間速度", "5", 18, "12/11時間後", "時計角度"),
        
        ("分速80mで15分歩いた距離は？",
         [{"id":"A","text":"1200m"},{"id":"B","text":"1000m"},{"id":"C","text":"1500m"},{"id":"D","text":"800m"}],
         [0], "時間速度", "2", 8, "80×15=1200", "距離計算"),
    ]
    
    questions.extend(time_speed_questions)
    print(f"  ✓ 時間・速度計算: {len(time_speed_questions)}問")
    
    # ==================== 割合・比率（15問） ====================
    print("[2/4] 割合・比率問題を生成中...")
    
    ratio_questions = [
        ("100の20%は？",
         [{"id":"A","text":"20"},{"id":"B","text":"25"},{"id":"C","text":"15"},{"id":"D","text":"30"}],
         [0], "割合", "2", 8, "100×0.2=20", "基本％計算"),
        
        ("200円の30%引きは？",
         [{"id":"A","text":"140円"},{"id":"B","text":"160円"},{"id":"C","text":"120円"},{"id":"D","text":"150円"}],
         [0], "割合", "2", 8, "200×0.7=140", "割引計算"),
        
        ("A:B=2:3、A=10のときBは？",
         [{"id":"A","text":"15"},{"id":"B","text":"12"},{"id":"C","text":"20"},{"id":"D","text":"18"}],
         [0], "割合", "2", 8, "10÷2×3=15", "比の計算"),
        
        ("500円が20%増えると？",
         [{"id":"A","text":"600円"},{"id":"B","text":"550円"},{"id":"C","text":"650円"},{"id":"D","text":"580円"}],
         [0], "割合", "2", 8, "500×1.2=600", "増加計算"),
        
        ("40人中8人が欠席。出席率は？",
         [{"id":"A","text":"80%"},{"id":"B","text":"75%"},{"id":"C","text":"85%"},{"id":"D","text":"70%"}],
         [0], "割合", "2", 8, "32÷40=0.8", "出席率"),
        
        ("3:4:5の比で60を分けると最大は？",
         [{"id":"A","text":"25"},{"id":"B","text":"20"},{"id":"C","text":"30"},{"id":"D","text":"15"}],
         [0], "割合", "3", 10, "60×5/12=25", "比例配分"),
        
        ("原価800円、2割の利益。売値は？",
         [{"id":"A","text":"960円"},{"id":"B","text":"1000円"},{"id":"C","text":"900円"},{"id":"D","text":"880円"}],
         [0], "割合", "2", 8, "800×1.2=960", "利益計算"),
        
        ("濃度5%の食塩水200g。食塩は何g？",
         [{"id":"A","text":"10g"},{"id":"B","text":"5g"},{"id":"C","text":"15g"},{"id":"D","text":"20g"}],
         [0], "割合", "2", 8, "200×0.05=10", "濃度計算"),
        
        ("15は60の何%？",
         [{"id":"A","text":"25%"},{"id":"B","text":"20%"},{"id":"C","text":"30%"},{"id":"D","text":"15%"}],
         [0], "割合", "2", 8, "15÷60=0.25", "百分率"),
        
        ("A:B=3:5、A+B=80。Aは？",
         [{"id":"A","text":"30"},{"id":"B","text":"40"},{"id":"C","text":"25"},{"id":"D","text":"35"}],
         [0], "割合", "3", 10, "80×3/8=30", "合計から逆算"),
        
        ("10%の食塩水300gと20%の食塩水200gを混ぜると？",
         [{"id":"A","text":"14%"},{"id":"B","text":"15%"},{"id":"C","text":"16%"},{"id":"D","text":"13%"}],
         [0], "割合", "4", 15, "(30+40)÷500=0.14", "濃度混合"),
        
        ("定価の2割引きで1600円。定価は？",
         [{"id":"A","text":"2000円"},{"id":"B","text":"1800円"},{"id":"C","text":"2200円"},{"id":"D","text":"1900円"}],
         [0], "割合", "3", 10, "1600÷0.8=2000", "逆算"),
        
        ("男子24人、女子16人。男子の割合は？",
         [{"id":"A","text":"60%"},{"id":"B","text":"50%"},{"id":"C","text":"40%"},{"id":"D","text":"70%"}],
         [0], "割合", "2", 8, "24÷40=0.6", "構成比"),
        
        ("800円が20%引き後、さらに10%引き。最終価格は？",
         [{"id":"A","text":"576円"},{"id":"B","text":"600円"},{"id":"C","text":"560円"},{"id":"D","text":"640円"}],
         [0], "割合", "3", 12, "800×0.8×0.9=576", "連続割引"),
        
        ("AとBの比が2:3。Aを30%増やすとBと同じ。元のAは？",
         [{"id":"A","text":"不可能"},{"id":"B","text":"100"},{"id":"C","text":"150"},{"id":"D","text":"200"}],
         [0], "割合", "4", 15, "条件矛盾（問題設定確認）", "比と増減"),
    ]
    
    questions.extend(ratio_questions)
    print(f"  ✓ 割合・比率: {len(ratio_questions)}問")
    
    # ==================== 規則性発見（10問） ====================
    print("[3/4] 規則性発見問題を生成中...")
    
    pattern_questions = [
        ("1, 4, 9, 16, 25の規則は？",
         [{"id":"A","text":"平方数"},{"id":"B","text":"素数"},{"id":"C","text":"2倍"},{"id":"D","text":"奇数"}],
         [0], "規則性", "2", 8, "n²の数列", "数列規則"),
        
        ("A, C, E, G, ?",
         [{"id":"A","text":"I"},{"id":"B","text":"H"},{"id":"C","text":"J"},{"id":"D","text":"K"}],
         [0], "規則性", "2", 8, "1つ飛ばし", "文字規則"),
        
        ("○△□○△□○△?",
         [{"id":"A","text":"□"},{"id":"B","text":"○"},{"id":"C","text":"△"},{"id":"D","text":"×"}],
         [0], "規則性", "2", 8, "3つのパターン繰り返し", "図形規則"),
        
        ("1, 1, 2, 6, 24, ?",
         [{"id":"A","text":"120"},{"id":"B","text":"48"},{"id":"C","text":"72"},{"id":"D","text":"96"}],
         [0], "規則性", "3", 12, "階乗数列", "積の規則"),
        
        ("月火水木金土?",
         [{"id":"A","text":"日"},{"id":"B","text":"月"},{"id":"C","text":"曜"},{"id":"D","text":"終"}],
         [0], "規則性", "1", 5, "曜日の順", "周期性"),
        
        ("2, 6, 12, 20, 30, ?",
         [{"id":"A","text":"42"},{"id":"B","text":"40"},{"id":"C","text":"38"},{"id":"D","text":"44"}],
         [0], "規則性", "3", 12, "n(n+1)の数列", "積の形"),
        
        ("春夏秋冬春夏?",
         [{"id":"A","text":"秋"},{"id":"B","text":"冬"},{"id":"C","text":"春"},{"id":"D","text":"夏"}],
         [0], "規則性", "1", 5, "四季の繰り返し", "循環"),
        
        ("赤青黄緑赤青?",
         [{"id":"A","text":"黄"},{"id":"B","text":"緑"},{"id":"C","text":"赤"},{"id":"D","text":"青"}],
         [0], "規則性", "2", 8, "4色の繰り返し", "色パターン"),
        
        ("A1, B2, C3, D4, ?",
         [{"id":"A","text":"E5"},{"id":"B","text":"E4"},{"id":"C","text":"D5"},{"id":"D","text":"F5"}],
         [0], "規則性", "2", 8, "文字と数字両方増加", "複合規則"),
        
        ("10, 20, 15, 30, 25, 50, ?",
         [{"id":"A","text":"45"},{"id":"B","text":"40"},{"id":"C","text":"50"},{"id":"D","text":"35"}],
         [0], "規則性", "3", 12, "×2と-5の交互", "交互演算"),
    ]
    
    questions.extend(pattern_questions)
    print(f"  ✓ 規則性発見: {len(pattern_questions)}問")
    
    # ==================== 条件整理（10問） ====================
    print("[4/4] 条件整理問題を生成中...")
    
    condition_questions = [
        ("A>B, B>C, C>D。最大は？",
         [{"id":"A","text":"A"},{"id":"B","text":"B"},{"id":"C","text":"C"},{"id":"D","text":"D"}],
         [0], "条件整理", "2", 8, "推移律", "大小比較"),
        
        ("赤か青、青でない、よって？",
         [{"id":"A","text":"赤"},{"id":"B","text":"青"},{"id":"C","text":"黄"},{"id":"D","text":"不明"}],
         [0], "条件整理", "2", 8, "消去法", "排他的選択"),
        
        ("AはBの兄、BはCの姉。AとCの関係は？",
         [{"id":"A","text":"兄妹"},{"id":"B","text":"姉妹"},{"id":"C","text":"兄弟"},{"id":"D","text":"不明"}],
         [0], "条件整理", "3", 10, "Aは男性、Cは女性", "家族関係"),
        
        ("5人：太郎は花子より背が高い。次郎は太郎より低い。花子は三郎より高い。四郎は次郎より高い。最も高いのは？",
         [{"id":"A","text":"太郎"},{"id":"B","text":"花子"},{"id":"C","text":"四郎"},{"id":"D","text":"不明"}],
         [0], "条件整理", "4", 15, "太郎>花子>三郎、太郎>四郎>次郎", "順序推定"),
        
        ("猫か犬、鳴かない、犬は鳴く。よって？",
         [{"id":"A","text":"猫"},{"id":"B","text":"犬"},{"id":"C","text":"両方"},{"id":"D","text":"不明"}],
         [0], "条件整理", "3", 10, "条件から推論", "三段論法"),
        
        ("A,B,Cが野球、サッカー、テニスをする。Aは球を蹴らない。Bはネットを使わない。Cのスポーツは？",
         [{"id":"A","text":"サッカー"},{"id":"B","text":"野球"},{"id":"C","text":"テニス"},{"id":"D","text":"不明"}],
         [0], "条件整理", "3", 12, "消去法で特定", "配置問題"),
        
        ("3人が赤白青の服。Aは赤でない、Bは白でない、Cは青でない。Aの服は？",
         [{"id":"A","text":"白か青"},{"id":"B","text":"赤"},{"id":"C","text":"青"},{"id":"D","text":"白"}],
         [0], "条件整理", "3", 12, "Aは赤以外", "条件から推定"),
        
        ("月曜から金曜まで5教科。国語は水曜より前、数学は木曜、英語は火曜でない、理科は国語の翌日。月曜の教科は？",
         [{"id":"A","text":"国語"},{"id":"B","text":"英語"},{"id":"C","text":"社会"},{"id":"D","text":"理科"}],
         [0], "条件整理", "5", 20, "条件から配置決定", "スケジュール"),
        
        ("4人が1~4位。Aは1位でない。Bは最下位でない。Cは2位。Dの順位は？",
         [{"id":"A","text":"1位か4位"},{"id":"B","text":"1位"},{"id":"C","text":"4位"},{"id":"D","text":"3位"}],
         [0], "条件整理", "3", 12, "残りの位置", "順位決定"),
        
        ("犬、猫、鳥がいる。犬は吠える、猫は鳴く、鳥は鳴く。吠えない動物は？",
         [{"id":"A","text":"猫と鳥"},{"id":"B","text":"犬"},{"id":"C","text":"猫"},{"id":"D","text":"鳥"}],
         [0], "条件整理", "2", 8, "犬以外", "分類整理"),
    ]
    
    questions.extend(condition_questions)
    print(f"  ✓ 条件整理: {len(condition_questions)}問")
    
    # データベースに挿入
    print("データベースに保存中...")
    for q in questions:
        question_json = {
            "question": q[0],
            "options": q[1],
            "answer": q[2]
        }
        
        cursor.execute("""
            INSERT INTO questions 
            (language, question_json, category, difficulty, score, meaning, usage)
            VALUES (?, ?, ?, ?, ?, ?, ?)
        """, ("IQ", json.dumps(question_json, ensure_ascii=False), 
              q[3], q[4], q[5], q[6], q[7]))
    
    conn.commit()
    
    # 統計表示
    cursor.execute("SELECT COUNT(*) FROM questions WHERE language = 'IQ'")
    iq_count = cursor.fetchone()[0]
    
    cursor.execute("SELECT COUNT(*) FROM questions")
    total_count = cursor.fetchone()[0]
    
    conn.close()
    
    print("=" * 60)
    print("✓ IQ問題追加完了（第7弾）！")
    print("=" * 60)
    print(f"IQ問題数: {iq_count}問")
    print(f"全体問題数: {total_count}問")
    print(f"目標500問まで残り: {max(0, 500 - iq_count)}問")
    print("=" * 60)

if __name__ == "__main__":
    add_iq_batch7()