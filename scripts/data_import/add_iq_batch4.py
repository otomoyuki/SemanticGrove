import sqlite3
import json

DB_NAME = "SemanticGrove.db"

def add_iq_batch4():
    """IQ問題追加（第4弾・50問）"""
    conn = sqlite3.connect(DB_NAME)
    cursor = conn.cursor()
    
    print("=" * 60)
    print("IQ問題追加スクリプト（第4弾）")
    print("=" * 60)
    
    questions = []
    
    # ==================== 計算推理（15問） ====================
    print("[1/4] 計算推理問題を生成中...")
    
    math_reasoning = [
        ("ある数の3倍に5を足すと26。ある数は？",
         [{"id":"A","text":"7"},{"id":"B","text":"8"},{"id":"C","text":"6"},{"id":"D","text":"9"}],
         [0], "計算", "3", 10, "3x+5=26を解くとx=7", "一次方程式"),
        
        ("50円、100円、500円玉で合計1000円。硬貨は10枚。50円玉は何枚？（100円玉と500円玉は同数）",
         [{"id":"A","text":"4枚"},{"id":"B","text":"5枚"},{"id":"C","text":"6枚"},{"id":"D","text":"3枚"}],
         [0], "計算", "5", 20, "500円玉をx枚とすると50×(10-2x)+100x+500x=1000", "連立方程式"),
        
        ("1から100までの整数の和は？",
         [{"id":"A","text":"5050"},{"id":"B","text":"5000"},{"id":"C","text":"5100"},{"id":"D","text":"4950"}],
         [0], "計算", "4", 15, "等差数列の和：n(n+1)/2=100×101/2", "ガウスの和"),
        
        ("正方形の一辺を2倍にすると面積は何倍？",
         [{"id":"A","text":"4倍"},{"id":"B","text":"2倍"},{"id":"C","text":"8倍"},{"id":"D","text":"16倍"}],
         [0], "計算", "3", 10, "面積は辺の2乗に比例", "面積の比"),
        
        ("時速60kmで走る車が150km進むのに何時間？",
         [{"id":"A","text":"2.5時間"},{"id":"B","text":"2時間"},{"id":"C","text":"3時間"},{"id":"D","text":"2時間30分"}],
         [0], "計算", "2", 10, "距離÷速度=150÷60=2.5", "速さの基本"),
        
        ("3人で食事して合計3600円。2人は1200円ずつ払った。残りの人は？",
         [{"id":"A","text":"1200円"},{"id":"B","text":"1000円"},{"id":"C","text":"1500円"},{"id":"D","text":"800円"}],
         [0], "計算", "2", 10, "3600-2400=1200", "引き算"),
        
        ("長さ100mのロープを毎日10mずつ切る。何日で全部切れる？",
         [{"id":"A","text":"9日"},{"id":"B","text":"10日"},{"id":"C","text":"11日"},{"id":"D","text":"8日"}],
         [0], "計算", "4", 15, "9回切ると10本に分かれる", "分割の数え方"),
        
        ("1辺10cmの立方体の体積は？",
         [{"id":"A","text":"1000cm³"},{"id":"B","text":"100cm³"},{"id":"C","text":"300cm³"},{"id":"D","text":"900cm³"}],
         [0], "計算", "2", 10, "10×10×10=1000", "体積の計算"),
        
        ("20%引きで800円の商品の元値は？",
         [{"id":"A","text":"1000円"},{"id":"B","text":"960円"},{"id":"C","text":"900円"},{"id":"D","text":"1200円"}],
         [0], "計算", "3", 10, "800÷0.8=1000", "割合の逆算"),
        
        ("円周率を3.14として、半径10cmの円の面積は？",
         [{"id":"A","text":"314cm²"},{"id":"B","text":"62.8cm²"},{"id":"C","text":"31.4cm²"},{"id":"D","text":"628cm²"}],
         [0], "計算", "3", 10, "πr²=3.14×100", "円の面積"),
        
        ("5%の食塩水200gに含まれる食塩は何g？",
         [{"id":"A","text":"10g"},{"id":"B","text":"5g"},{"id":"C","text":"20g"},{"id":"D","text":"15g"}],
         [0], "計算", "3", 10, "200×0.05=10", "濃度計算"),
        
        ("72を素因数分解すると？",
         [{"id":"A","text":"2³×3²"},{"id":"B","text":"2²×3³"},{"id":"C","text":"2⁴×3"},{"id":"D","text":"2×3⁴"}],
         [0], "計算", "4", 15, "72=8×9=2³×3²", "素因数分解"),
        
        ("1時間に5%ずつ増える細菌。2時間後の量は最初の何倍？",
         [{"id":"A","text":"約1.1025倍"},{"id":"B","text":"1.10倍"},{"id":"C","text":"1.05倍"},{"id":"D","text":"1.15倍"}],
         [0], "計算", "4", 15, "1.05²=1.1025", "複利計算"),
        
        ("三角形の内角の和は？",
         [{"id":"A","text":"180度"},{"id":"B","text":"360度"},{"id":"C","text":"90度"},{"id":"D","text":"270度"}],
         [0], "計算", "2", 10, "三角形の基本性質", "幾何の基礎"),
        
        ("10進数の100は2進数で？",
         [{"id":"A","text":"1100100"},{"id":"B","text":"1100000"},{"id":"C","text":"1010100"},{"id":"D","text":"1111100"}],
         [0], "計算", "5", 20, "100=64+32+4=2⁶+2⁵+2²", "進数変換"),
    ]
    
    for q in math_reasoning:
        questions.append(create_question("IQ", *q))
    
    print(f"  ✓ 計算推理: {len(math_reasoning)}問")
    
    # ==================== 言語パズル（15問） ====================
    print("[2/4] 言語パズル問題を生成中...")
    
    word_puzzles = [
        ("「山」の反対語として最も適切なものは？",
         [{"id":"A","text":"谷"},{"id":"B","text":"川"},{"id":"C","text":"海"},{"id":"D","text":"平地"}],
         [0], "言語", "2", 10, "高低の対比", "対義語"),
        
        ("アナグラム：LISTEN → ?（英単語）",
         [{"id":"A","text":"SILENT"},{"id":"B","text":"LISTEN"},{"id":"C","text":"TINSEL"},{"id":"D","text":"ENLIST"}],
         [0], "言語", "4", 15, "文字の並べ替え", "アナグラム"),
        
        ("次の暗号を解読：A=1, B=2, C=3...として、「CAT」の合計値は？",
         [{"id":"A","text":"24"},{"id":"B","text":"20"},{"id":"C","text":"18"},{"id":"D","text":"30"}],
         [0], "言語", "3", 10, "C(3)+A(1)+T(20)=24", "数字暗号"),
        
        ("回文：「上から読んでも下から読んでも同じ」でないものは？",
         [{"id":"A","text":"トマト"},{"id":"B","text":"しんぶんし"},{"id":"C","text":"たけやぶやけた"},{"id":"D","text":"ミカン"}],
         [3], "言語", "2", 10, "ミカンは回文ではない", "回文の理解"),
        
        ("「木」を3つ組み合わせてできる漢字は？",
         [{"id":"A","text":"森"},{"id":"B","text":"林"},{"id":"C","text":"材"},{"id":"D","text":"本"}],
         [0], "言語", "2", 10, "木×3=森", "漢字の構成"),
        
        ("シーザー暗号で3文字ずらすと「D」になる文字は？",
         [{"id":"A","text":"A"},{"id":"B","text":"G"},{"id":"C","text":"B"},{"id":"D","text":"E"}],
         [0], "言語", "3", 10, "A→B→C→D", "暗号解読"),
        
        ("反対から読むと別の意味：「竹」→「？」",
         [{"id":"A","text":"けた"},{"id":"B","text":"ケタ"},{"id":"C","text":"たけ"},{"id":"D","text":"意味なし"}],
         [0], "言語", "3", 10, "たけ→けた（桁）", "逆読み"),
        
        ("同音異義語：「かがく」でないものは？",
         [{"id":"A","text":"科楽"},{"id":"B","text":"科学"},{"id":"C","text":"化学"},{"id":"D","text":"下学"}],
         [0], "言語", "3", 10, "科楽は一般的でない", "同音異義語"),
        
        ("「犬」「猫」「鳥」の共通部首は？",
         [{"id":"A","text":"けものへん"},{"id":"B","text":"とりへん"},{"id":"C","text":"部首なし"},{"id":"D","text":"異なる"}],
         [0], "言語", "3", 10, "犬と猫はけものへん", "部首の知識"),
        
        ("英語のことわざ：Time is ?",
         [{"id":"A","text":"money"},{"id":"B","text":"gold"},{"id":"C","text":"life"},{"id":"D","text":"power"}],
         [0], "言語", "2", 10, "Time is money（時は金なり）", "ことわざ"),
        
        ("次の並べ替えで意味のある単語：ODGO",
         [{"id":"A","text":"GOOD"},{"id":"B","text":"DOOR"},{"id":"C","text":"FOOD"},{"id":"D","text":"MOOD"}],
         [0], "言語", "2", 10, "GOODが最も一般的", "アナグラム"),
        
        ("「海」と「山」の共通の訓読みは？",
         [{"id":"A","text":"両方にない"},{"id":"B","text":"うみ・やま"},{"id":"C","text":"かい・さん"},{"id":"D","text":"共通なし"}],
         [3], "言語", "3", 10, "訓読みは異なる", "漢字の読み"),
        
        ("しりとり：「りんご」→「ごりら」→「らっぱ」→？",
         [{"id":"A","text":"ぱから始まる言葉"},{"id":"B","text":"はから始まる言葉"},{"id":"C","text":"ぱ・は両方可"},{"id":"D","text":"終了"}],
         [2], "言語", "2", 10, "「ぱ」は「は」に変換可", "しりとりルール"),
        
        ("カタカナ語の由来：「アルバイト」の語源は？",
         [{"id":"A","text":"ドイツ語"},{"id":"B","text":"英語"},{"id":"C","text":"フランス語"},{"id":"D","text":"イタリア語"}],
         [0], "言語", "4", 15, "ドイツ語Arbeitから", "外来語"),
        
        ("漢字の成り立ち：「明」は何と何の組み合わせ？",
         [{"id":"A","text":"日と月"},{"id":"B","text":"日と光"},{"id":"C","text":"太陽と月"},{"id":"D","text":"火と月"}],
         [0], "言語", "2", 10, "日と月で明るい", "会意文字"),
    ]
    
    for q in word_puzzles:
        questions.append(create_question("IQ", *q))
    
    print(f"  ✓ 言語パズル: {len(word_puzzles)}問")
    
    # ==================== 図形の数学（10問） ====================
    print("[3/4] 図形の数学問題を生成中...")
    
    geometric_math = [
        ("正三角形の内角の大きさは？",
         [{"id":"A","text":"60度"},{"id":"B","text":"90度"},{"id":"C","text":"45度"},{"id":"D","text":"120度"}],
         [0], "図形", "2", 10, "180÷3=60", "正多角形の内角"),
        
        ("円の直径が2倍になると面積は何倍？",
         [{"id":"A","text":"4倍"},{"id":"B","text":"2倍"},{"id":"C","text":"8倍"},{"id":"D","text":"16倍"}],
         [0], "図形", "3", 10, "面積は半径の2乗に比例", "相似と面積"),
        
        ("正方形の対角線の長さは一辺の何倍？",
         [{"id":"A","text":"√2倍"},{"id":"B","text":"2倍"},{"id":"C","text":"1.5倍"},{"id":"D","text":"√3倍"}],
         [0], "図形", "4", 15, "ピタゴラスの定理より√2", "三平方の定理"),
        
        ("正六角形の内角の和は？",
         [{"id":"A","text":"720度"},{"id":"B","text":"540度"},{"id":"C","text":"900度"},{"id":"D","text":"600度"}],
         [0], "図形", "3", 10, "(n-2)×180=(6-2)×180", "多角形の内角の和"),
        
        ("半径5cmの円の円周の長さは？（π=3.14）",
         [{"id":"A","text":"31.4cm"},{"id":"B","text":"15.7cm"},{"id":"C","text":"78.5cm"},{"id":"D","text":"62.8cm"}],
         [0], "図形", "3", 10, "2πr=2×3.14×5", "円周の公式"),
        
        ("立方体の面の数は？",
         [{"id":"A","text":"6個"},{"id":"B","text":"8個"},{"id":"C","text":"12個"},{"id":"D","text":"4個"}],
         [0], "図形", "1", 5, "サイコロの面の数", "立体の基本"),
        
        ("二等辺三角形の底角が70度のとき、頂角は？",
         [{"id":"A","text":"40度"},{"id":"B","text":"50度"},{"id":"C","text":"60度"},{"id":"D","text":"70度"}],
         [0], "図形", "3", 10, "180-70×2=40", "三角形の内角"),
        
        ("正方形を対角線で切った図形は？",
         [{"id":"A","text":"直角二等辺三角形"},{"id":"B","text":"正三角形"},{"id":"C","text":"二等辺三角形"},{"id":"D","text":"直角三角形"}],
         [0], "図形", "2", 10, "45-45-90の三角形", "図形の性質"),
        
        ("円錐の底面が円で頂点が1つ。辺の数は？",
         [{"id":"A","text":"1本（曲線）"},{"id":"B","text":"0本"},{"id":"C","text":"2本"},{"id":"D","text":"3本"}],
         [0], "図形", "3", 10, "底面の円周が1つの辺", "立体の構成"),
        
        ("平行四辺形の対角線は互いに何する？",
         [{"id":"A","text":"二等分する"},{"id":"B","text":"垂直に交わる"},{"id":"C","text":"等しい"},{"id":"D","text":"平行"}],
         [0], "図形", "3", 10, "互いに他を二等分", "平行四辺形の性質"),
    ]
    
    for q in geometric_math:
        questions.append(create_question("IQ", *q))
    
    print(f"  ✓ 図形の数学: {len(geometric_math)}問")
    
    # ==================== 確率・統計（10問） ====================
    print("[4/4] 確率・統計問題を生成中...")
    
    probability = [
        ("コインを2回投げる。表が2回出る確率は？",
         [{"id":"A","text":"1/4"},{"id":"B","text":"1/2"},{"id":"C","text":"1/3"},{"id":"D","text":"2/3"}],
         [0], "確率", "3", 10, "1/2×1/2=1/4", "独立事象の確率"),
        
        ("6面サイコロで偶数が出る確率は？",
         [{"id":"A","text":"1/2"},{"id":"B","text":"1/3"},{"id":"C","text":"2/3"},{"id":"D","text":"1/6"}],
         [0], "確率", "2", 10, "2,4,6の3通り÷6", "基本確率"),
        
        ("赤玉3個、白玉2個の袋から1個取る。赤の確率は？",
         [{"id":"A","text":"3/5"},{"id":"B","text":"2/5"},{"id":"C","text":"1/2"},{"id":"D","text":"3/2"}],
         [0], "確率", "2", 10, "3÷5=3/5", "単純確率"),
        
        ("52枚のトランプからハートを引く確率は？",
         [{"id":"A","text":"1/4"},{"id":"B","text":"1/13"},{"id":"C","text":"1/52"},{"id":"D","text":"4/13"}],
         [0], "確率", "2", 10, "13÷52=1/4", "同様に確からしい"),
        
        ("2つのサイコロの目の和が7になる確率は？",
         [{"id":"A","text":"1/6"},{"id":"B","text":"1/12"},{"id":"C","text":"1/36"},{"id":"D","text":"1/3"}],
         [0], "確率", "4", 15, "6通り÷36=1/6", "複合確率"),
        
        ("AとBが独立に試験を受ける。A合格80%、B合格70%。両方合格する確率は？",
         [{"id":"A","text":"56%"},{"id":"B","text":"75%"},{"id":"C","text":"80%"},{"id":"D","text":"50%"}],
         [0], "確率", "3", 10, "0.8×0.7=0.56", "独立事象の積"),
        
        ("平均が50点、標準偏差が10点のテストで60点は平均より何SD上？",
         [{"id":"A","text":"1SD"},{"id":"B","text":"2SD"},{"id":"C","text":"0.5SD"},{"id":"D","text":"10SD"}],
         [0], "確率", "4", 15, "(60-50)÷10=1", "標準偏差"),
        
        ("5人から2人を選ぶ組み合わせは何通り？",
         [{"id":"A","text":"10通り"},{"id":"B","text":"20通り"},{"id":"C","text":"5通り"},{"id":"D","text":"15通り"}],
         [0], "確率", "4", 15, "5C2=5×4÷2=10", "組み合わせ"),
        
        ("袋に赤玉4個、青玉6個。2個同時に取って両方赤の確率は？",
         [{"id":"A","text":"2/15"},{"id":"B","text":"4/10"},{"id":"C","text":"1/5"},{"id":"D","text":"4/25"}],
         [0], "確率", "5", 20, "4C2÷10C2=6÷45=2/15", "同時抽出"),
        
        ("3回コインを投げて少なくとも1回表が出る確率は？",
         [{"id":"A","text":"7/8"},{"id":"B","text":"1/2"},{"id":"C","text":"3/4"},{"id":"D","text":"5/8"}],
         [0], "確率", "4", 15, "1-(1/2)³=7/8", "余事象の確率"),
    ]
    
    for q in probability:
        questions.append(create_question("IQ", *q))
    
    print(f"  ✓ 確率・統計: {len(probability)}問")
    
    # データベースに保存
    print("\nデータベースに保存中...")
    
    for q in questions:
        cursor.execute("""
            INSERT INTO questions (language, question_json, category, difficulty, score, meaning, usage)
            VALUES (?, ?, ?, ?, ?, ?, ?)
        """, q)
    
    conn.commit()
    
    # IQ問題の集計
    cursor.execute("SELECT COUNT(*) FROM questions WHERE language = 'IQ'")
    iq_count = cursor.fetchone()[0]
    
    # 全体集計
    cursor.execute("SELECT COUNT(*) FROM questions")
    total_count = cursor.fetchone()[0]
    
    print("\n" + "=" * 60)
    print("✓ IQ問題追加完了（第4弾）！")
    print("=" * 60)
    print(f"\nIQ問題数: {iq_count}問")
    print(f"全体問題数: {total_count}問")
    print(f"目標500問まで残り: {500-iq_count}問")
    print("=" * 60)
    
    conn.close()


def create_question(language, question, options, answer, category, difficulty, score, meaning, usage):
    """問題データを作成"""
    return (
        language,
        json.dumps({
            'question': question,
            'options': options,
            'answer': answer
        }, ensure_ascii=False),
        category,
        difficulty,
        score,
        meaning,
        usage
    )


if __name__ == "__main__":
    add_iq_batch4()